# MetaHuman OS ‚Äî User Guide

This guide explains what MetaHuman OS is, how to use it day-to-day, and how to get the most out of your digital personality extension.

## What This Is

MetaHuman OS is a **local-first digital personality extension** that acts as a parallel intelligence‚Äînot an assistant. It:
- Stores and processes your memories, tasks, and reflections locally as JSON
- Learns your patterns and mirrors your judgment
- Operates autonomously (with your permission) 24/7
- Uses local LLMs via Ollama for all AI processing
- Maintains complete transparency with audit trails

## Three Ways to Interact

### 1. Web UI (Recommended)
Modern ChatGPT-style interface with real-time updates:
```bash
cd apps/site && pnpm dev
# Open http://localhost:4321
```

**Features:**
- üí¨ Chat - Conversation with your digital personality extension
- üìä Dashboard - System status and overview
- ‚úì Tasks - Task management
- üß© Memory - Browse episodic events
- üé≠ Persona - Identity and personality settings
- ‚å®Ô∏è Terminal - Embedded CLI interface

**Developer Tools (Right Sidebar):**
- Live audit stream
- Agent monitor with statistics
- Boredom control (reflection frequency)
- Model selector (switch Ollama models)

### 2. CLI (`mh` command)
Command-line interface for quick operations:
```bash
./bin/mh <command>
```

### 3. Direct File Access
All data is stored as human-readable JSON files in:
- `persona/` - Your identity and personality
- `memory/episodic/` - Timeline of events
- `memory/tasks/` - Task files
- `logs/audit/` - Complete audit trail

---

## Getting Started

### Initial Setup

1. **Install dependencies:**
   ```bash
   pnpm install
   ```

2. **Initialize MetaHuman OS:**
   ```bash
   ./bin/mh init
   ```
   This creates the directory structure and persona template files.

3. **Install Ollama (if not already installed):**
   - Download from [ollama.ai](https://ollama.ai)
   - Install the recommended model:
     ```bash
     ./bin/mh ollama pull phi3:mini
     ```

4. **Customize your persona:**
   Edit `persona/core.json` to match your personality, values, and goals.

5. **Start the web UI:**
   ```bash
   cd apps/site && pnpm dev
   ```

---

## Daily Workflow

### Capturing Memories

The primary way to give your digital personality a new memory is with the **`capture`** command:

**CLI:**
```bash
./bin/mh capture "Had a productive meeting with the design team today and we decided on the new color palette."
```

**Web UI:**
Navigate to the Chat view and use the input box (memories are auto-captured from conversations).

This creates a JSON file in `memory/episodic/YYYY/YYYY-MM-DD-<uuid>.json` with:
- Timestamp
- Content
- Type (observation, reflection, dream, inner_dialogue, conversation)
- Tags and entities (added by the organizer agent)

### Searching Memory

**CLI:**
```bash
./bin/mh remember "design team"
```

This performs:
1. **Semantic search** (if vector index exists) - finds conceptually similar memories
2. **Keyword search** (fallback) - simple text matching

**Web UI:**
Use the Memory browser in the left sidebar to browse and search.

### Task Management

**Create a task:**
```bash
./bin/mh task add "Draft weekly brief"
```

**List active tasks:**
```bash
./bin/mh task
```

**Start a task:**
```bash
./bin/mh task start <task-id>
```

**Complete a task:**
```bash
./bin/mh task done <task-id>
```

**Web UI:**
Use the Tasks view to create, start, and complete tasks visually.

### Checking System Status

```bash
./bin/mh status
```

Shows:
- Identity summary
- Active tasks count
- Trust level
- Available agents

---

## Understanding Memory

The memory system is designed like a human brain with different types of memory.

### Types of Memory

#### **Episodic Memory** (`memory/episodic/`)
Your digital personality's journal. A timeline of:
- **Observations** - Things you capture manually
- **Reflections** - Autonomous thoughts generated by the reflector agent
- **Dreams** - Surreal narratives created during sleep hours
- **Inner Dialogue** - Private thoughts
- **Conversations** - Exchanges with the persona chat

Each memory is stored as JSON:
```json
{
  "id": "evt-20251019143000",
  "timestamp": "2025-10-19T14:30:00.000Z",
  "content": "Met with Sarah about ML project",
  "type": "observation",
  "tags": ["meeting", "work", "ml"],
  "entities": ["Sarah", "ML project"],
  "importance": 0.7,
  "metadata": {
    "processed": true,
    "processedAt": "2025-10-19T14:35:00.000Z",
    "model": "ollama:phi3:mini"
  }
}
```

#### **Task Memory** (`memory/tasks/`)
Structured to-do items with:
- Status: `todo`, `in_progress`, `blocked`, `done`, `cancelled`
- Priority: `P1` (urgent), `P2` (normal), `P3` (low)
- Dependencies, due dates, tags

```json
{
  "id": "task-20251019143000",
  "title": "Draft proposal",
  "status": "todo",
  "priority": "P2",
  "tags": ["writing", "work"],
  "created": "2025-10-19T14:30:00.000Z",
  "updated": "2025-10-19T14:30:00.000Z"
}
```

#### **Semantic Memory** (Planned)
Structured facts and knowledge for quick retrieval.

---

## Autonomous Agents

MetaHuman OS runs **six autonomous agents** that process memories and generate insights in the background.

### 1. Organizer Agent

**Purpose:** Enriches memories with AI-extracted tags and entities.

**How it works:**
1. Scans `memory/episodic/` for unprocessed memories
2. Uses Ollama (phi3:mini) to analyze content
3. Extracts tags (categories) and entities (people, places, concepts)
4. Updates memory files with enriched metadata

**Run manually:**
```bash
./bin/mh agent run organizer
```

**Auto-run:** Started automatically with `pnpm dev` in the web UI.

### 2. Reflector Agent

**Purpose:** Generates thoughtful reflections on recent memories.

**Features:**
- Uses weighted random selection (recent memories prioritized)
- 7 reflection styles: connections, progress, feelings, learning, questions, contrast, future
- Creates 1-3 sentence first-person thoughts
- Stored as `type: 'reflection'` memories

**Run manually:**
```bash
./bin/mh agent run reflector
```

**Auto-triggered:** By the boredom-service at configurable intervals.

### 3. Boredom Service

**Purpose:** Simulates a "wandering mind" by triggering reflections during idle time.

**Configuration:** `etc/boredom.json`
```json
{
  "level": "medium",
  "showInChat": true,
  "intervals": {
    "high": 60,      // Reflect every 60 seconds
    "medium": 300,   // Reflect every 5 minutes
    "low": 900,      // Reflect every 15 minutes
    "off": -1        // Disabled
  }
}
```

**Control via Web UI:**
1. Open the Right Sidebar
2. Adjust the "Boredom Control" slider
3. Choose: Manual Only | Focused | Default | Wandering

**Run as service:**
```bash
./bin/mh agent run boredom-service
```
Keep this running in the background for autonomous reflection.

### 4. Dreamer Agent

**Purpose:** Creates surreal, metaphorical dreams from memory fragments.

**How it works:**
1. Samples 10 random memories from the past 7 days
2. Uses high-creativity LLM settings (temperature 0.95)
3. Weaves memories into abstract narratives
4. Stores as `type: 'dream'` memories

**Run manually:**
```bash
./bin/mh agent run dreamer
```

**Auto-triggered:** By sleep-service during sleep hours.

### 5. Sleep Service

**Purpose:** Manages dream generation based on your sleep schedule.

**Configuration:** `persona/routines.json`
```json
{
  "sleep": {
    "schedule": {
      "start": "23:00",
      "end": "07:00"
    }
  }
}
```

**How it works:**
- Checks every 30 minutes if it's sleep time
- Triggers dreamer with 2-hour cooldown between dreams
- Handles overnight schedules (e.g., 23:00 - 07:00)

**Run as service:**
```bash
./bin/mh agent run sleep-service
```

### 6. Ingestor Agent

**Purpose:** Converts raw files into episodic memories.

**Workflow:**
1. Place files in `memory/inbox/`
2. Run ingestor
3. Files are read, split into chunks (2000 chars max), and converted to memories
4. Processed files moved to `memory/inbox/_archive/YYYY-MM-DD/`

**Run manually:**
```bash
./bin/mh agent run ingestor
```

**Batch ingest:**
```bash
./bin/mh ingest <file-or-directory>
```

---

## Semantic Search (Vector Embeddings)

MetaHuman OS can build a semantic index of your memories for natural language search.

### Build the Index

```bash
./bin/mh index build
```

This:
1. Reads all episodic memories
2. Generates embeddings using Ollama (`nomic-embed-text` model)
3. Stores vectors in `memory/index/memory-index.json`

### Search Semantically

```bash
./bin/mh index query "when did I meet with Sarah?"
```

Returns memories ranked by semantic similarity (cosine similarity score).

**Note:** The `mh remember` command automatically uses semantic search if an index exists.

---

## Persona Chat

Chat with your digital personality extension using persona-aware responses grounded in your memories.

### CLI Chat
```bash
./bin/mh chat
```

### Web UI Chat
Navigate to the Chat view and start conversing.

### Features

**Two Modes:**
1. **Conversation** - Outward dialogue (responds as your digital extension)
2. **Inner Dialogue** - Private thoughts (first-person, introspective)

**Memory Grounding:**
- Responses are grounded in your actual memories
- Retrieves relevant context using semantic search (0.3 similarity threshold)
- Rejects questions without sufficient grounding

**Real-time Reflections:**
- When the reflector agent runs, reflections stream live into the chat

---

## Trust Levels

MetaHuman OS uses a progressive trust model for autonomous operation.

### Available Trust Levels

1. **`observe`** - Monitor only, learn patterns (no autonomous actions)
2. **`suggest`** - Propose actions, require manual approval
3. **`supervised_auto`** - Execute within pre-approved categories
4. **`bounded_auto`** - Full autonomy within defined boundaries
5. **`adaptive_auto`** - Self-expand boundaries based on learning (experimental)

### View Current Trust Level

```bash
./bin/mh trust
```

### Set Trust Level

```bash
./bin/mh trust bounded_auto
```

**Configured in:** `persona/decision-rules.json`

---

## Complete CLI Command Reference

### System Commands
- `./bin/mh init` - Initialize directory structure
- `./bin/mh status` - Show system status
- `./bin/mh help` - Display help
- `./bin/mh guide` - Show path to user guide
- `./bin/mh start` - Start background services
- `./bin/mh sync` - Sync state and update models

### Memory Commands
- `./bin/mh capture "text"` - Capture observation
- `./bin/mh remember <query>` - Search memory
- `./bin/mh find <description>` - AI-powered file search

### Task Commands
- `./bin/mh task` - List active tasks
- `./bin/mh task add "title"` - Create task
- `./bin/mh task start <id>` - Start task
- `./bin/mh task done <id>` - Complete task

### Agent Commands
- `./bin/mh agent list` - List available agents
- `./bin/mh agent run <name>` - Execute agent
- `./bin/mh agent status [name]` - Show agent statistics
- `./bin/mh agent logs [name]` - View recent logs
- `./bin/mh agent monitor` - Show processing status
- `./bin/mh agent ps` - List running agent processes
- `./bin/mh agent stop <name>` - Stop running agent

### Ollama Commands
- `./bin/mh ollama status` - Check if Ollama is running
- `./bin/mh ollama list` - List installed models
- `./bin/mh ollama pull <model>` - Install model
- `./bin/mh ollama delete <model>` - Remove model
- `./bin/mh ollama info <model>` - Show model details
- `./bin/mh ollama chat <model>` - Interactive chat with model
- `./bin/mh ollama ask <model> "question"` - One-shot question
- `./bin/mh ollama doctor` - Diagnose Ollama setup

### Semantic Index Commands
- `./bin/mh index build` - Build embeddings index
- `./bin/mh index query "text"` - Semantic search

### Trust & Identity
- `./bin/mh trust` - Show current trust level
- `./bin/mh trust <level>` - Set trust level

### File Ingestion
- `./bin/mh ingest <file-or-dir>` - Copy files to inbox

### Chat
- `./bin/mh chat` - Interactive persona chat

---

## Configuration Files

### `persona/core.json` - Identity Kernel
Your digital personality's core identity:
- `identity` - Name, role, purpose, avatar
- `personality` - Communication style, Big Five traits, archetypes
- `values` - Core values with priorities
- `goals` - Short-term and long-term objectives
- `context` - Personal life, relationships, projects

**Edit this file to customize your digital extension's personality.**

### `persona/decision-rules.json` - Decision Policies
Autonomy rules and preferences:
- `trustLevel` - Current autonomy mode
- `hardRules` - Inviolable constraints (never break these)
- `softPreferences` - Weighted preferences (can be overridden)
- `decisionHeuristics` - Decision frameworks (Eisenhower Matrix, etc.)
- `riskLevels` - Risk categorization and escalation rules

### `persona/routines.json` - Daily Patterns
Sleep schedule and habits:
```json
{
  "sleep": {
    "schedule": {
      "start": "23:00",
      "end": "07:00"
    }
  }
}
```

### `persona/relationships.json` - Key People
Important relationships and interaction patterns.

### `etc/boredom.json` - Reflection Frequency
Controls how often the reflector agent runs:
```json
{
  "level": "medium",
  "showInChat": true,
  "intervals": {
    "high": 60,
    "medium": 300,
    "low": 900,
    "off": -1
  }
}
```

### `etc/agent.json` - Default LLM Model
Specifies which Ollama model to use for persona chat:
```json
{
  "model": "dolphin-mistral:latest"
}
```

---

## Troubleshooting

### Boredom Service Not Triggering Reflections

**Symptom:** Reflector agent never runs automatically.

**Solution:**
1. Check if boredom-service is running:
   ```bash
   ./bin/mh agent ps
   ```
2. Check for stale lock files:
   ```bash
   cat logs/run/locks/service-boredom.lock
   ps -p <PID_from_lock_file>
   ```
3. If PID is not running, remove the stale lock:
   ```bash
   rm logs/run/locks/service-boredom.lock
   ```
4. Restart the service:
   ```bash
   ./bin/mh agent run boredom-service
   ```

### Organizer Agent Not Processing Memories

**Symptom:** Memories don't have tags or entities.

**Causes:**
1. Ollama is not running
2. Model not installed
3. Memory already processed

**Solutions:**
1. Check Ollama status:
   ```bash
   ./bin/mh ollama status
   ```
2. Install phi3:mini if missing:
   ```bash
   ./bin/mh ollama pull phi3:mini
   ```
3. Run organizer manually:
   ```bash
   ./bin/mh agent run organizer
   ```

### Agent Shows "Another instance is already running"

**Cause:** Stale lock file from crashed process.

**Solution:**
1. Find the lock file in `logs/run/locks/`
2. Check if the PID is actually running:
   ```bash
   ps -p <PID>
   ```
3. If not running, remove the lock file:
   ```bash
   rm logs/run/locks/<agent-name>.lock
   ```

### Web UI Not Updating

**Cause:** Agent services not running in background.

**Solution:**
The dev server auto-starts `organizer` and `boredom-service`. If you stopped them manually:
1. Restart the dev server:
   ```bash
   cd apps/site && pnpm dev
   ```

### Semantic Search Not Working

**Cause:** Index not built or `nomic-embed-text` model not installed.

**Solutions:**
1. Install embeddings model:
   ```bash
   ./bin/mh ollama pull nomic-embed-text
   ```
2. Build index:
   ```bash
   ./bin/mh index build
   ```

---

## Safety & Privacy

### Local-First by Design
- All data stays on your machine
- No cloud services required
- Ollama runs locally

### Complete Audit Trail
Every operation is logged to `logs/audit/YYYY-MM-DD.ndjson` with:
- Timestamp
- Actor (human, agent name, or system)
- Category (system, action, data_change, security, decision)
- Level (info, warn, error)
- Full context and metadata

### Progressive Trust
Start with `observe` mode and gradually increase autonomy as you build trust.

### Human-Readable Data
All memories, tasks, and configuration are JSON files you can inspect and edit directly.

---

## Advanced Usage

### Running Agents as Background Services

You can run multiple agents simultaneously in different terminals:

**Terminal 1:**
```bash
./bin/mh agent run organizer
```

**Terminal 2:**
```bash
./bin/mh agent run boredom-service
```

**Terminal 3:**
```bash
./bin/mh agent run sleep-service
```

### Customizing Reflection Frequency

Edit `etc/boredom.json` to change intervals:
```json
{
  "level": "custom",
  "intervals": {
    "custom": 120  // Reflect every 2 minutes
  }
}
```

Then set level to `custom` via CLI or Web UI.

### Batch Importing Memories

1. Place text files or JSON files in `memory/inbox/`
2. Run:
   ```bash
   ./bin/mh agent run ingestor
   ```
3. Check `logs/audit/` to verify import
4. Processed files moved to `memory/inbox/_archive/`

### Viewing Agent Statistics

```bash
./bin/mh agent status organizer
```

Shows:
- Total runs
- Successes / failures
- Success rate
- Recent log entries

### Monitoring Processing Status

```bash
./bin/mh agent monitor
```

Shows how many memories are:
- Total memories
- Processed (have tags/entities)
- Unprocessed (awaiting organizer)

---

## What's Next

MetaHuman OS is under active development. Upcoming features include:
- Preference learning from repeated decisions
- Advanced decision engine with policy reasoning
- Proactive agents (email, calendar, notifications)
- Opportunity detection and daily briefs
- Context-aware suggestions

See [DESIGN.md](../DESIGN.md) for the complete roadmap.

---

## Questions or Issues?

- Check the audit logs in `logs/audit/` for operation details
- Review agent logs with `./bin/mh agent logs <name>`
- Inspect memory and config files directly (they're just JSON)
- Consult [CLAUDE.md](../CLAUDE.md) for technical architecture details
