# Memory System

The memory system is the heart of MetaHuman OS. It stores everything your digital personality learns, experiences, and remembers - creating a continuous timeline of your shared existence.

## Overview

MetaHuman OS uses a layered memory architecture:

1. **Episodic Memory**: Timeline of events, conversations, and observations
2. **Task Memory**: Structured to-do items with priorities and due dates
3. **Function Memory**: Learned workflows and multi-step patterns
4. **Conversation Summaries**: Condensed history for long-running sessions
5. **Semantic Index**: Vector embeddings for natural language search

All memories are stored as human-readable JSON files in the `memory/` directory.

## Types of Episodic Memory

Your digital personality maintains several types of episodic memories:

### Conversations üí¨
- User-assistant dialogue exchanges
- Questions and responses from chat sessions
- Includes cognitive mode and model information
- Automatically captured from web UI and CLI chat

### Observations üëÅÔ∏è
- Manually captured events and notes
- Created via `mh capture "text"` command
- Tagged and entity-enriched by organizer agent
- Your way of sharing experiences with MetaHuman

### Inner Dialogue üí≠
- Reflections generated by the reflector agent
- Internal questions from inner curiosity agent
- Associative memory chains (3-5 linked memories)
- **Never shown in main chat** - these are private thoughts

### Dreams üåô
- Surreal narratives woven from memory fragments
- Created by dreamer agent during sleep cycles
- Access entire lifetime with exponential decay weighting
- Abstract, metaphorical connections between memories

### Tasks ‚úì
- Structured to-do items with status tracking
- Priorities, due dates, dependencies
- Project organization and categorization
- See [Task Management](task-management.md) for details

## Memory Structure

Each memory is stored as a JSON file with this structure:

```json
{
  "id": "evt-20251019143000",
  "timestamp": "2025-10-19T14:30:00.000Z",
  "content": "Met with Sarah about ML project",
  "type": "observation",
  "tags": ["meeting", "work", "ml"],
  "entities": ["Sarah", "ML project"],
  "importance": 0.7,
  "metadata": {
    "cognitiveMode": "dual",
    "processed": true,
    "processedAt": "2025-10-19T14:35:00.000Z",
    "model": "ollama:phi3:mini"
  }
}
```

**Key Fields:**
- **id**: Unique identifier
- **timestamp**: When the event occurred (ISO 8601)
- **content**: The actual memory text
- **type**: Memory category (conversation, observation, inner_dialogue, dream, task)
- **tags**: Keywords extracted by the organizer agent
- **entities**: People, places, and topics mentioned
- **importance**: Relevance score (0.0 to 1.0)
- **cognitiveMode**: Which mode was active when created (dual/agent/emulation)

## Memory Browser (Web UI)

The web interface provides 7 specialized tabs for viewing and managing memories:

### 1. Conversations Tab
- Shows only `type: 'conversation'` memories
- User-assistant dialogue exchanges
- Filterable by date, cognitive mode, participant
- Inline expansion and full-screen editor

### 2. Observations Tab
- Shows only `type: 'observation'` memories
- Manual captures via `mh capture` command
- Personal notes and event recordings
- Tagged and entity-enriched

### 3. Inner Dialogue Tab
- Shows only `type: 'inner_dialogue'` memories
- Reflections and internal thoughts
- Entire lifetime access with reflective weighting
- Never appears in main chat

### 4. Dreams Tab
- Shows only `type: 'dream'` memories
- Surreal narratives from sleep cycles
- Yellow/gold left border styling
- Shows source memory IDs that inspired the dream

### 5. Tasks Tab
- Shows only `type: 'task'` memories
- Task management view
- See [Task Management](task-management.md) for full details

### 6. All Memories Tab
- Unified view of all memory types
- Advanced filters (date range, type, tags, entities, cognitive mode)
- Bulk operations (export/delete)
- Full-text search across all fields

### 7. Search Tab
- Advanced search interface
- Date range picker
- Memory type selector
- Tag filtering
- Entity search
- Semantic search (if index built)
- Results grouped by relevance

## Memory Interaction Controls

Each memory card includes:

- **Expand/Collapse Toggle (‚ñº/‚ñ∂)**: View full content inline
- **Edit Button (‚úèÔ∏è)**: Open full-screen modal editor
- **Validate Button (+)**: Mark memory as correct for training
- **Delete Button (‚àí)**: Remove memory immediately

### Memory Editor Modal

The full-screen editor provides:

- **Keyboard shortcuts**:
  - **Ctrl+S**: Save changes
  - **Esc**: Close editor
- **Auto-save detection**: Warns about unsaved changes
- **Permission-based access**: Requires authentication to edit
- **Read-only mode**: Anonymous users and emulation mode
- **Audit logging**: All edits tracked with timestamp and actor
- **JSON formatting**: Auto-formatted for readability

## Capturing Memories

### Via CLI

```bash
# Capture an observation
./bin/mh capture "Had a productive meeting with the design team"

# The organizer agent will automatically:
# - Extract tags and entities
# - Assess importance
# - Store in memory/episodic/YYYY/YYYY-MM-DD-<uuid>.json
```

### Via Web UI

Memories are automatically captured from:
- Chat conversations
- Voice interactions
- Manual observation entries

### Via File Ingestion

```bash
# Place files in inbox
cp my-notes.txt memory/inbox/

# Run the ingestor agent
./bin/mh agent run ingestor

# View extracted memories in Memory Browser
```

### Via Audio

```bash
# Upload audio via Voice tab in web UI
# OR place audio files in memory/audio/inbox/

# Transcriber and audio-organizer agents process automatically
# View transcribed memories in Memory Browser
```

## Searching Memories

### CLI Search

```bash
# Simple keyword search
./bin/mh remember "design team"

# Semantic search (if index built)
./bin/mh index query "when did I meet with Sarah?"
```

### Web UI Search

Use the Search tab in the Memory Browser for:
- Advanced filtering
- Multi-field searches
- Semantic similarity
- Date range selection
- Tag and entity filtering

## Semantic Search & Vector Index

Build a semantic index for natural language search:

```bash
# Build the index
./bin/mh index build

# This will:
# 1. Read all episodic memories
# 2. Generate embeddings using Ollama (nomic-embed-text)
# 3. Store vectors in memory/index/memory-index.json

# Search semantically
./bin/mh index query "when did I meet with Sarah?"

# Returns memories ranked by similarity score
```

**Note**: The `mh remember` command automatically uses semantic search if an index exists.

## Conversation Continuity

MetaHuman OS maintains conversation context across sessions:

- **Session IDs**: Each chat gets a stable `conversationId`
- **Rolling Buffers**: Last ~20 turns in memory for fast prompting
- **Persistence**: Full history saved in `profiles/<user>/state/conversation-buffer-*.json`
- **Summaries**: When buffers overflow, older turns are condensed into `type: "summary"` memories
- **Context Builder**: Automatically assembles relevant context for each query

## Function Memory

Function Memory stores reusable workflows learned from successful operator runs:

**Directory Structure**:
```
memory/functions/
‚îú‚îÄ‚îÄ verified/        # User-approved, trusted functions
‚îî‚îÄ‚îÄ drafts/          # Auto-learned, awaiting review
```

**How It Works**:
1. Operator successfully completes a multi-step task
2. System analyzes the skill sequence
3. Creates a "draft" function in `drafts/`
4. You review and approve via web UI
5. Approved functions move to `verified/`
6. Future similar tasks automatically use the proven workflow

## Memory Validation

Mark memories as correct or incorrect for training data quality:

- **+ Button**: Mark as correct (high-quality training data)
- **‚àí Button**: Delete incorrect memories
- **Validation badge**: Shows "correct" or "incorrect" status
- **Training integration**: Validated memories influence AI training quality

## Storage Locations

All memory data is stored in the `memory/` directory:

```
memory/
‚îú‚îÄ‚îÄ episodic/           # Timeline of events
‚îÇ   ‚îî‚îÄ‚îÄ YYYY/           # Organized by year
‚îÇ       ‚îî‚îÄ‚îÄ YYYY-MM-DD-<uuid>.json
‚îú‚îÄ‚îÄ tasks/              # To-do items
‚îÇ   ‚îú‚îÄ‚îÄ active/
‚îÇ   ‚îú‚îÄ‚îÄ completed/
‚îÇ   ‚îî‚îÄ‚îÄ projects/
‚îú‚îÄ‚îÄ functions/          # Learned workflows
‚îÇ   ‚îú‚îÄ‚îÄ verified/
‚îÇ   ‚îî‚îÄ‚îÄ drafts/
‚îú‚îÄ‚îÄ inbox/              # Files awaiting ingestion
‚îÇ   ‚îî‚îÄ‚îÄ _archive/       # Processed files
‚îî‚îÄ‚îÄ index/              # Vector embeddings
    ‚îî‚îÄ‚îÄ memory-index.json
```

## Memory Continuity Guarantees

MetaHuman OS follows a layered memory approach:

1. **Phase 1**: Every tool/file/action is captured
2. **Phase 2**: Prompts always assemble the right context
3. **Phase 3**: Long conversations are summarized and indexed
4. **Phase 4**: Per-profile metadata flows into every call
5. **Phase 5**: Observability keeps the pipeline honest

This ensures your digital personality never forgets important information.

## Next Steps

- Set up [Task Management](task-management.md) to organize your goals
- Learn about [Autonomous Agents](../advanced-features/autonomous-agents.md) that enrich and organize memories
- Explore [Cognitive Modes](../training-personalization/cognitive-modes.md) to understand how memories are created
- Check [AI Training](../training-personalization/ai-training.md) to see how memories become personality
