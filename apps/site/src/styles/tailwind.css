@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html { color-scheme: light dark; }

  body {
    @apply bg-white text-gray-900 dark:bg-gray-950 dark:text-gray-100;
  }

  /* Ensure all text defaults to proper colors in dark mode */
  .dark {
    color: rgb(243 244 246); /* gray-100 */
  }
}

@layer components {
  /* === Original Components === */
  .container-page {
    @apply min-h-screen bg-white text-gray-900 dark:bg-gray-950 dark:text-gray-100;
  }
  .page-max {
    @apply max-w-6xl mx-auto px-4 py-8;
  }
  .card {
    @apply rounded-lg border border-gray-200/60 dark:border-white/10 bg-white/70 dark:bg-gray-900/60 shadow-sm;
  }
  .muted {
    @apply text-gray-500 dark:text-gray-400;
  }
  .btn {
    @apply inline-flex items-center gap-2 rounded-md px-4 py-2 bg-brand text-white hover:bg-brand/90 transition font-medium;
  }

  /* Brand color */
  :root {
    --color-brand: #3b82f6;
  }
  .dark {
    --color-brand: #60a5fa;
  }
  .bg-brand { background-color: var(--color-brand); }
  .text-brand { color: var(--color-brand); }
  .ring-brand { --tw-ring-color: var(--color-brand); }

  /* === View Container Components === */
  .view-container {
    @apply flex flex-col h-full overflow-hidden;
  }

  .view-header {
    @apply px-8 pt-6 pb-4 border-b border-black/10 dark:border-white/10 flex-shrink-0;
  }

  .view-title {
    @apply text-2xl font-bold text-gray-900 dark:text-gray-100 m-0 mb-1;
  }

  .view-subtitle {
    @apply text-sm text-gray-500 dark:text-gray-400 m-0;
  }

  .view-content {
    @apply flex-1 overflow-y-auto overflow-x-hidden p-8;
  }

  /* === Tab Components === */
  .tab-group {
    @apply flex gap-2 mb-3;
  }

  .tab-button {
    @apply px-3 py-1.5 rounded-full border border-black/15 dark:border-white/20
           bg-white dark:bg-white/5 text-gray-700 dark:text-gray-300
           cursor-pointer font-semibold text-sm transition-all
           hover:bg-gray-50 dark:hover:bg-white/10;
  }

  .tab-button.active {
    @apply bg-violet-600 dark:bg-violet-400 text-white dark:text-gray-900 border-transparent;
  }

  /* === Card Components === */
  .event-card {
    @apply p-4 rounded-lg border border-black/10 dark:border-white/10
           bg-white dark:bg-white/5;
  }

  .event-card-header {
    @apply flex items-center justify-between gap-3;
  }

  .event-card-title {
    @apply font-semibold text-gray-900 dark:text-gray-100 m-0;
  }

  .event-card-meta {
    @apply flex items-center justify-between gap-2 mt-1;
  }

  .event-card-time {
    @apply text-sm text-gray-500 dark:text-gray-400;
  }

  .event-card-content {
    @apply mt-3 text-gray-700 dark:text-gray-300 whitespace-pre-wrap break-words;
  }

  /* === Tag Components === */
  .tag {
    @apply text-xs px-1.5 py-0.5 rounded bg-violet-600/10 dark:bg-violet-400/20
           text-violet-700 dark:text-violet-300 font-medium;
  }

  .tag-blue {
    @apply text-xs px-1.5 py-0.5 rounded bg-blue-500/10 dark:bg-blue-400/20
           text-blue-600 dark:text-blue-400 font-medium;
  }

  .tag-yellow {
    @apply text-xs px-1.5 py-0.5 rounded bg-yellow-500/10 dark:bg-yellow-400/20
           text-yellow-600 dark:text-yellow-400 font-medium;
  }

  .tag-green {
    @apply text-xs px-1.5 py-0.5 rounded bg-green-500/10 dark:bg-green-400/20
           text-green-600 dark:text-green-400 font-medium;
  }

  .tag-red {
    @apply text-xs px-1.5 py-0.5 rounded bg-red-500/10 dark:bg-red-400/20
           text-red-600 dark:text-red-400 font-medium;
  }

  /* === Empty/Loading States === */
  .empty-state {
    @apply flex flex-col items-center justify-center h-full text-gray-500 dark:text-gray-400;
  }

  .empty-icon {
    @apply text-6xl mb-4 opacity-50;
  }

  .empty-title {
    @apply text-xl font-semibold mb-2 text-gray-900 dark:text-gray-100;
  }

  .empty-description {
    @apply text-sm text-center max-w-md;
  }

  .empty-description code {
    @apply px-1.5 py-0.5 rounded bg-black/10 dark:bg-white/10 font-mono text-sm;
  }

  /* === Button Components === */
  .btn-validation {
    @apply w-7 h-7 rounded-md border border-black/15 dark:border-white/20
           bg-white dark:bg-white/5 font-bold cursor-pointer
           transition-all hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed;
  }

  .btn-validation-good {
    @apply btn-validation text-green-600 border-green-600/30
           hover:bg-green-50 dark:hover:bg-green-900/20;
  }

  .btn-validation-bad {
    @apply btn-validation text-red-600 border-red-600/30
           hover:bg-red-50 dark:hover:bg-red-900/20;
  }

  .btn-expand {
    @apply px-3 py-1.5 rounded-md border border-black/15 dark:border-white/20
           bg-white dark:bg-white/5 text-sm font-medium
           cursor-pointer transition-colors
           hover:bg-gray-50 dark:hover:bg-white/10;
  }

  /* === Metadata Components === */
  .metadata-grid {
    @apply grid grid-cols-2 gap-x-3 gap-y-1.5 mt-2;
  }

  .metadata-label {
    @apply text-xs font-semibold text-gray-600 dark:text-gray-400;
  }

  .metadata-value {
    @apply text-xs text-gray-900 dark:text-gray-200 font-mono;
  }

  /* === Persona Form === */
  .form-group {
    @apply mb-4;
  }

  .form-label {
    @apply block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1;
  }

  .form-input {
    @apply w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600
           bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100
           focus:outline-none focus:ring-2 focus:ring-violet-500 dark:focus:ring-violet-400;
  }

  .form-textarea {
    @apply form-input resize-y min-h-[100px];
  }

  .form-button {
    @apply px-4 py-2 rounded-lg font-semibold transition-all
           bg-violet-600 dark:bg-violet-500 text-white
           hover:bg-violet-700 dark:hover:bg-violet-600
           disabled:opacity-50 disabled:cursor-not-allowed;
  }

  .form-button-secondary {
    @apply px-4 py-2 rounded-lg font-semibold transition-all
           bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100
           hover:bg-gray-300 dark:hover:bg-gray-600;
  }

  /* === Message Components === */
  .message-success {
    @apply px-4 py-3 rounded-lg bg-green-50 dark:bg-green-900/20
           border border-green-200 dark:border-green-700
           text-green-800 dark:text-green-300;
  }

  .message-error {
    @apply px-4 py-3 rounded-lg bg-red-50 dark:bg-red-900/20
           border border-red-200 dark:border-red-700
           text-red-800 dark:text-red-300;
  }

  /* === Border Accents === */
  .border-accent-violet {
    @apply border-l-4 border-l-violet-600 dark:border-l-violet-400;
  }

  .border-accent-blue {
    @apply border-l-4 border-l-blue-500 dark:border-l-blue-400;
  }

  .border-accent-yellow {
    @apply border-l-4 border-l-yellow-500 dark:border-l-yellow-400;
  }

  .border-accent-green {
    @apply border-l-4 border-l-green-500 dark:border-l-green-400;
  }

  /* === Utility Classes === */
  .text-mono-sm {
    @apply font-mono text-xs;
  }

  .clickable-reset {
    @apply bg-transparent border-0 p-0 m-0 cursor-pointer text-left;
  }

  /* === Chat Interface Components === */
  .chat-interface {
    @apply flex flex-col h-full w-full overflow-hidden;
  }

  .mode-toggle-container {
    @apply flex flex-wrap items-center justify-between gap-3 p-4 border-b border-black/10 dark:border-white/10 flex-shrink-0;
  }

  .mode-toggle {
    @apply flex flex-wrap items-center gap-2 p-1 bg-black/5 dark:bg-white/5 rounded-lg;
  }

  .mode-btn {
    @apply inline-flex items-center gap-2 px-3 py-2 border-0 bg-transparent rounded-md text-sm font-medium text-gray-500 dark:text-gray-400 cursor-pointer transition-all;
  }
  .mode-btn:hover {
    @apply bg-black/5 dark:bg-white/5;
  }
  .mode-btn.active {
    @apply bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 shadow-sm;
  }

  .clear-btn {
    @apply px-4 py-2 border border-black/10 dark:border-white/10 bg-transparent rounded-md text-sm font-medium text-gray-500 dark:text-gray-400 cursor-pointer transition-all;
  }
  .clear-btn:hover {
    @apply border-red-600 text-red-600 dark:border-red-400 dark:text-red-400;
  }

  /* Input controls */
  .input-controls {
    @apply w-full flex items-center gap-3 flex-wrap mb-0;
  }

  .small-toggle {
    @apply flex items-center gap-1.5 text-xs text-gray-500 dark:text-gray-400;
  }
  .small-toggle input {
    accent-color: rgb(79 70 229);
  }

  .operator-toggle-group {
    @apply relative flex items-center gap-1.5 flex-wrap;
  }

  .operator-info-trigger {
    @apply inline-flex items-center justify-center w-6 h-6 rounded-full border border-indigo-600/35 bg-indigo-600/10 text-indigo-600 cursor-pointer transition-all;
  }
  .operator-info-trigger:hover {
    @apply bg-indigo-600/20 border-indigo-600/55;
  }
  .operator-info-trigger[aria-expanded="true"] {
    @apply bg-violet-600/20 border-violet-600/50 text-violet-600;
  }

  .operator-popover {
    @apply absolute bottom-full left-0 mb-2 w-72 max-w-[80vw] p-3 rounded-xl border shadow-xl z-20;
    background: rgba(255, 255, 255, 0.98);
    border-color: rgba(79, 70, 229, 0.2);
    color: rgb(55 65 81);
  }

  :global(.dark) .operator-popover {
    background: rgba(17, 24, 39, 0.95);
    border-color: rgba(167, 139, 250, 0.35);
    color: rgb(209 213 219);
  }

  .operator-popover::before {
    content: '';
    @apply absolute -bottom-1.5 left-4 w-3 h-3 border-b border-r;
    transform: rotate(45deg);
    background: rgba(255, 255, 255, 0.98);
    border-color: rgba(79, 70, 229, 0.2);
  }

  :global(.dark) .operator-popover::before {
    background: rgba(17, 24, 39, 0.95);
    border-color: rgba(167, 139, 250, 0.35);
  }

  .operator-focus {
    @apply px-2.5 py-1.5 rounded-md border border-black/15 dark:border-white/20 text-xs bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 ml-auto;
    flex: 0 1 180px;
  }

  /* Messages */
  .messages-container {
    @apply flex-1 overflow-y-auto overflow-x-hidden;
  }

  .messages-list {
    @apply flex flex-col gap-6 p-8 max-w-3xl mx-auto w-full;
  }

  .message {
    @apply flex flex-col gap-2;
  }

  .message-header {
    @apply flex justify-between items-center;
  }

  .message-role {
    @apply text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-400;
  }
  .message-user .message-role {
    @apply text-violet-600 dark:text-violet-400;
  }

  .message-time {
    @apply text-xs text-gray-400 dark:text-gray-500;
  }

  .message-content {
    @apply p-4 rounded-xl text-sm leading-relaxed whitespace-pre-wrap break-words;
  }
  .message-user .message-content {
    @apply bg-violet-600 dark:bg-violet-400 text-white dark:text-gray-900 ml-auto max-w-[85%];
  }
  .message-assistant .message-content {
    @apply bg-black/5 dark:bg-white/5 text-gray-900 dark:text-gray-100 max-w-[85%];
  }
  .message-reflection .message-content {
    @apply bg-violet-400/10 text-violet-700 dark:text-violet-300 border border-violet-400/30 max-w-[85%] italic;
  }

  /* Input area */
  .input-container {
    @apply p-4 border-t border-black/10 dark:border-white/10 bg-white/80 dark:bg-gray-950/80 backdrop-blur-xl flex-shrink-0;
    padding-bottom: calc(1rem + env(safe-area-inset-bottom, 0px));
  }

  .input-wrapper {
    @apply flex flex-col gap-3 max-w-3xl mx-auto;
  }

  .input-row {
    @apply flex items-end gap-3;
  }

  .chat-input {
    @apply flex-1 px-4 py-3 border border-black/10 dark:border-white/10 rounded-xl text-sm resize-none bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100;
    max-height: 200px;
    font-family: inherit;
  }
  .chat-input:focus {
    @apply outline-none border-violet-600 dark:border-violet-400 ring-2 ring-violet-600/10 dark:ring-violet-400/10;
  }
  .chat-input:disabled {
    @apply opacity-50 cursor-not-allowed;
  }

  .input-actions {
    @apply flex items-center gap-2;
  }

  .send-btn {
    @apply flex items-center justify-center p-3 border-0 rounded-xl bg-violet-600 dark:bg-violet-400 text-white dark:text-gray-900 cursor-pointer transition-all;
  }
  .send-btn:hover:not(:disabled) {
    @apply bg-violet-700 dark:bg-violet-300;
    transform: translateY(-1px);
  }
  .send-btn:disabled {
    @apply opacity-50 cursor-not-allowed;
  }

  .mic-btn {
    @apply inline-flex items-center justify-center px-2.5 py-2.5 border border-black/10 dark:border-white/10 rounded-xl bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 cursor-pointer;
  }
  .mic-btn:disabled {
    @apply opacity-60 cursor-not-allowed;
  }

  .welcome-screen {
    @apply flex flex-col items-center justify-center h-full p-8 text-center;
  }

  .welcome-icon {
    @apply text-6xl mb-4;
  }

  .welcome-title {
    @apply text-3xl font-bold text-gray-900 dark:text-gray-100 m-0 mb-2;
  }

  .welcome-subtitle {
    @apply text-base text-gray-500 dark:text-gray-400 m-0 mb-8;
  }

  .suggestion {
    @apply p-4 border border-black/10 dark:border-white/10 bg-white dark:bg-gray-900 rounded-xl text-sm text-gray-900 dark:text-gray-100 cursor-pointer transition-all text-left;
  }
  .suggestion:hover {
    @apply border-violet-600 dark:border-violet-400 shadow-lg shadow-violet-600/15 dark:shadow-violet-400/15;
  }

  /* Typing indicator */
  .typing {
    @apply flex gap-1.5 px-4 py-3;
  }
  .typing-dot {
    @apply w-2 h-2 rounded-full bg-gray-500 dark:bg-gray-400;
    animation: typing 1.4s infinite;
  }
  .typing-dot:nth-child(2) {
    animation-delay: 0.2s;
  }
  .typing-dot:nth-child(3) {
    animation-delay: 0.4s;
  }
  @keyframes typing {
    0%, 60%, 100% {
      transform: translateY(0);
      opacity: 0.7;
    }
    30% {
      transform: translateY(-0.5rem);
      opacity: 1;
    }
  }

  /* === Sidebar Components === */
  .menu {
    @apply flex flex-col gap-1;
  }

  .menu-item {
    @apply flex items-center gap-3 px-3 py-3 border-0 bg-transparent rounded-lg cursor-pointer transition-all text-left w-full;
  }
  .menu-item:hover {
    @apply bg-black/5 dark:bg-white/5;
  }
  .menu-item.active {
    @apply bg-violet-600 dark:bg-violet-400 text-white dark:text-gray-900;
  }

  .menu-icon {
    @apply text-xl flex-shrink-0;
  }

  .menu-text {
    @apply flex flex-col gap-0.5 min-w-0;
  }

  .menu-label {
    @apply font-medium text-sm text-gray-900 dark:text-gray-100;
  }
  .menu-item.active .menu-label {
    @apply text-white dark:text-gray-900;
  }

  .menu-description {
    @apply text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap overflow-hidden text-ellipsis;
  }
  .menu-item.active .menu-description {
    @apply text-white/80 dark:text-gray-900/70;
  }

  /* Status widget */
  .status-widget {
    @apply mt-auto p-4 rounded-lg border border-black/10 dark:border-white/10 bg-white/50 dark:bg-white/5;
  }

  .widget-header {
    @apply font-semibold text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400 mb-3;
  }

  .status-row {
    @apply flex items-center justify-between text-sm gap-2;
  }

  .status-label {
    @apply text-gray-500 dark:text-gray-400 font-medium;
  }

  .status-value {
    @apply text-gray-900 dark:text-gray-100 font-semibold flex items-center gap-1.5 text-right;
  }

  /* Badges */
  .status-badge {
    @apply inline-block px-2 py-0.5 rounded-full text-xs font-semibold lowercase border;
  }

  .adapter-badge {
    @apply px-1.5 py-0.5 rounded-full text-xs lowercase;
  }
  .adapter-badge.ok {
    @apply bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-300;
  }
  .adapter-badge.warn {
    @apply bg-yellow-100 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-300;
  }
  .adapter-badge.info {
    @apply bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-300;
  }

  .trust-observe {
    @apply bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300;
  }
  .trust-suggest {
    @apply bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300;
  }
  .trust-supervised_auto {
    @apply bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300;
  }
  .trust-bounded_auto {
    @apply bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300;
  }

  /* === Tab Components (RightSidebar style) === */
  .tabs {
    @apply flex border-b border-black/10 dark:border-white/10 flex-shrink-0;
  }

  .tab {
    @apply flex-1 flex flex-col items-center gap-1 px-2 py-3 border-0 bg-transparent cursor-pointer transition-all border-b-2 border-b-transparent;
  }
  .tab:hover {
    @apply bg-black/5 dark:bg-white/5;
  }
  .tab.active {
    @apply border-b-violet-600 dark:border-b-violet-400 bg-violet-600/5 dark:bg-violet-400/5;
  }

  .tab-icon {
    @apply text-xl;
  }

  .tab-label {
    @apply text-xs font-medium text-gray-500 dark:text-gray-400;
  }
  .tab.active .tab-label {
    @apply text-violet-600 dark:text-violet-400;
  }

  /* === Settings Components === */
  .setting-group {
    @apply mb-6;
  }

  .setting-label {
    @apply block text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wide;
  }

  .info-grid {
    @apply flex flex-col gap-2 p-3 rounded-lg bg-black/5 dark:bg-white/5;
  }

  .info-item {
    @apply flex justify-between text-sm;
  }

  .info-key {
    @apply text-gray-500 dark:text-gray-400;
  }

  .info-value {
    @apply font-semibold text-gray-900 dark:text-gray-100;
  }

  .danger-zone {
    @apply border border-red-600/20 dark:border-red-600/25 rounded-lg p-3 bg-red-600/5 dark:bg-red-600/10;
  }

  .danger-button {
    @apply border-0 bg-red-600 text-white text-sm font-semibold px-3 py-2 rounded-md cursor-pointer transition-all w-full;
  }
  .danger-button:hover:not(:disabled) {
    @apply bg-red-700;
  }
  .danger-button:disabled {
    @apply opacity-70 cursor-wait;
  }

  /* Toggle switch */
  .toggle-switch {
    @apply relative inline-block w-12 h-6 cursor-pointer;
  }
  .toggle-switch input {
    @apply opacity-0 w-0 h-0;
  }
  .toggle-slider {
    @apply absolute cursor-pointer top-0 left-0 right-0 bottom-0 bg-gray-300 dark:bg-gray-700 transition-all rounded-full;
  }
  .toggle-slider:before {
    content: "";
    @apply absolute bg-white transition-all rounded-full;
    height: 1.125rem;  /* 18px, equivalent to h-4.5 */
    width: 1.125rem;   /* 18px, equivalent to w-4.5 */
    left: 0.1875rem;   /* 3px, equivalent to left-0.75 */
    bottom: 0.1875rem; /* 3px, equivalent to bottom-0.75 */
  }
  .toggle-switch input:checked + .toggle-slider {
    @apply bg-violet-600 dark:bg-violet-400;
  }
  .toggle-switch input:checked + .toggle-slider:before {
    transform: translateX(1.5rem);
  }
  .toggle-switch input:disabled + .toggle-slider {
    @apply opacity-50 cursor-not-allowed;
  }

  /* === Scrollbar Styles === */
  .custom-scrollbar::-webkit-scrollbar {
    @apply w-2;
  }
  .custom-scrollbar::-webkit-scrollbar-track {
    @apply bg-transparent;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb {
    @apply bg-black/20 dark:bg-white/20 rounded;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    @apply bg-black/30 dark:bg-white/30;
  }

  /* === Layout Components === */
  .mode-label {
    @apply text-sm font-semibold px-3 py-1.5 rounded-full bg-white/55 dark:bg-gray-900/55 transition-all;
  }

  .mode-menu-trigger {
    @apply inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-gray-400/35 bg-white/55 dark:bg-gray-900/55 transition-all shadow-sm;
  }
  .mode-menu-trigger:hover {
    @apply border-violet-600/45 dark:border-violet-400/45;
  }

  .persona-icon {
    width: 28px;
    height: 28px;
    @apply rounded-full object-cover border-2 border-violet-600/30 dark:border-violet-400/40 bg-white dark:bg-white/5 flex-shrink-0;
  }
}
