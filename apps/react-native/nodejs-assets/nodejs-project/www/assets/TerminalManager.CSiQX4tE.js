import{S as te,i as le,s as ae,r as P,n as z,d as k,u as re,a2 as ne,a as X,b as g,x as V,c as i,e as C,f as B,h as N,X as K,g as ee,j as I,k as U,Y as Q,o as ie,l as R,U as se,v as oe,p as ce,O as q,Q as G,q as de,t as ue,a7 as H,a3 as he}from"./api-config.BAZ_dc_Y.js";import{bigBrotherTerminal as fe,bigBrotherTerminalOpened as J}from"./bigBrotherTerminal.CEpnOPL3.js";import"./index.enr_Xien.js";function L(r,l,a){const t=r.slice();return t[16]=l[a],t}function W(r,l,a){const t=r.slice();return t[16]=l[a],t}function Z(r){let l,a,t=r[16].title+"",h,d,o,f="Ã—",u,w,m,D,E;function x(){return r[8](r[16])}function T(...p){return r[9](r[16],...p)}function y(){return r[10](r[16])}function F(...p){return r[11](r[16],...p)}return{c(){l=I("div"),a=I("span"),h=ue(t),d=U(),o=I("button"),o.textContent=f,u=U(),this.h()},l(p){l=C(p,"DIV",{class:!0,role:!0,tabindex:!0,"aria-selected":!0});var b=B(l);a=C(b,"SPAN",{class:!0});var e=B(a);h=de(e,t),e.forEach(k),d=N(b),o=C(b,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),ee(o)!=="svelte-1gggnbs"&&(o.textContent=f),u=N(b),b.forEach(k),this.h()},h(){i(a,"class","tab-title svelte-1i9evyx"),i(o,"class","tab-close svelte-1i9evyx"),i(o,"aria-label","Close tab"),i(l,"class","tab svelte-1i9evyx"),i(l,"role","tab"),i(l,"tabindex",w=r[16].id===r[1]?0:-1),i(l,"aria-selected",m=r[16].id===r[1]),q(l,"active",r[16].id===r[1])},m(p,b){X(p,l,b),g(l,a),g(a,h),g(l,d),g(l,o),g(l,u),D||(E=[V(o,"click",G(x)),V(o,"keydown",G(T)),V(l,"click",y),V(l,"keydown",F)],D=!0)},p(p,b){r=p,b&1&&t!==(t=r[16].title+"")&&ce(h,t),b&3&&w!==(w=r[16].id===r[1]?0:-1)&&i(l,"tabindex",w),b&3&&m!==(m=r[16].id===r[1])&&i(l,"aria-selected",m),b&3&&q(l,"active",r[16].id===r[1])},d(p){p&&k(l),D=!1,oe(E)}}}function $(r,l){let a,t,h,d,o;return{key:r,first:null,c(){a=I("div"),t=I("iframe"),o=U(),this.h()},l(f){a=C(f,"DIV",{class:!0});var u=B(a);t=C(u,"IFRAME",{src:!0,title:!0,class:!0,sandbox:!0}),B(t).forEach(k),o=N(u),u.forEach(k),this.h()},h(){H(t.src,h=l[16].url)||i(t,"src",h),i(t,"title",d=l[16].title),i(t,"class","terminal-iframe svelte-1i9evyx"),i(t,"sandbox","allow-same-origin allow-scripts allow-forms"),i(a,"class","terminal-pane svelte-1i9evyx"),q(a,"active",l[16].id===l[1]),this.first=a},m(f,u){X(f,a,u),g(a,t),g(a,o)},p(f,u){l=f,u&1&&!H(t.src,h=l[16].url)&&i(t,"src",h),u&1&&d!==(d=l[16].title)&&i(t,"title",d),u&3&&q(a,"active",l[16].id===l[1])},d(f){f&&k(a)}}}function _e(r){let l,a,t,h,d,o,f,u,w,m,D="New",E,x,T,y=[],F=new Map,p,b,e=P(r[0]),n=[];for(let s=0;s<e.length;s+=1)n[s]=Z(W(r,e,s));let v=P(r[0]);const M=s=>s[16].id;for(let s=0;s<v.length;s+=1){let _=L(r,v,s),c=M(_);F.set(c,y[s]=$(c,_))}return{c(){l=I("div"),a=I("div"),t=I("div");for(let s=0;s<n.length;s+=1)n[s].c();h=U(),d=I("button"),o=Q("svg"),f=Q("line"),u=Q("line"),w=U(),m=I("span"),m.textContent=D,x=U(),T=I("div");for(let s=0;s<y.length;s+=1)y[s].c();this.h()},l(s){l=C(s,"DIV",{class:!0});var _=B(l);a=C(_,"DIV",{class:!0});var c=B(a);t=C(c,"DIV",{class:!0});var S=B(t);for(let O=0;O<n.length;O+=1)n[O].l(S);S.forEach(k),h=N(c),d=C(c,"BUTTON",{class:!0,"aria-label":!0});var j=B(d);o=K(j,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0});var A=B(o);f=K(A,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),B(f).forEach(k),u=K(A,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),B(u).forEach(k),A.forEach(k),w=N(j),m=C(j,"SPAN",{class:!0,"data-svelte-h":!0}),ee(m)!=="svelte-9brlpn"&&(m.textContent=D),j.forEach(k),c.forEach(k),x=N(_),T=C(_,"DIV",{class:!0});var Y=B(T);for(let O=0;O<y.length;O+=1)y[O].l(Y);Y.forEach(k),_.forEach(k),this.h()},h(){i(t,"class","tabs-list svelte-1i9evyx"),i(f,"x1","8"),i(f,"y1","4"),i(f,"x2","8"),i(f,"y2","12"),i(u,"x1","4"),i(u,"y1","8"),i(u,"x2","12"),i(u,"y2","8"),i(o,"width","10"),i(o,"height","10"),i(o,"viewBox","0 0 16 16"),i(o,"fill","none"),i(o,"stroke","currentColor"),i(o,"stroke-width","2"),i(m,"class","new-tab-text svelte-1i9evyx"),i(d,"class","new-tab-btn svelte-1i9evyx"),d.disabled=E=r[2]||r[0].length>=10,i(d,"aria-label","New terminal tab"),i(a,"class","tab-bar svelte-1i9evyx"),i(T,"class","terminals-content svelte-1i9evyx"),i(l,"class","terminal-manager svelte-1i9evyx")},m(s,_){X(s,l,_),g(l,a),g(a,t);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(t,null);g(a,h),g(a,d),g(d,o),g(o,f),g(o,u),g(d,w),g(d,m),g(l,x),g(l,T);for(let c=0;c<y.length;c+=1)y[c]&&y[c].m(T,null);p||(b=V(d,"click",r[3]),p=!0)},p(s,[_]){if(_&243){e=P(s[0]);let c;for(c=0;c<e.length;c+=1){const S=W(s,e,c);n[c]?n[c].p(S,_):(n[c]=Z(S),n[c].c(),n[c].m(t,null))}for(;c<n.length;c+=1)n[c].d(1);n.length=e.length}_&5&&E!==(E=s[2]||s[0].length>=10)&&(d.disabled=E),_&3&&(v=P(s[0]),y=ne(y,_,M,1,s,v,F,T,he,$,null,L))},i:z,o:z,d(s){s&&k(l),re(n,s);for(let _=0;_<y.length;_+=1)y[_].d();p=!1,b()}}}function ve(r,l,a){let t=[],h=null,d=!1,o=null;const f=fe.subscribe(e=>{e.shouldOpen&&!o&&u(e.port,e.url)});async function u(e,n){const v=t.find(s=>s.isBigBrother);if(v){a(1,h=v.id),J();return}const M={id:crypto.randomUUID(),port:e,title:"ðŸ¤– Big Brother",url:n,isBigBrother:!0};a(0,t=[...t,M]),a(1,h=M.id),o=M.id,J(),console.log("[TerminalManager] Opened Big Brother terminal on port",e)}ie(async()=>{await w();try{const e=await R("/api/claude-session");if(e.ok){const n=await e.json();n.success&&n.status?.ready&&!o&&(console.log("[TerminalManager] Big Brother session is active, opening terminal tab"),u(3099,"http://localhost:3099"))}}catch(e){console.warn("[TerminalManager] Could not check Claude session status:",e)}}),se(async()=>{for(const e of t)e.isBigBrother||await D(e.port);f()});async function w(){if(!d){a(2,d=!0);try{const e=await R("/api/terminal/spawn",{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok){const M=await e.json();console.error("[TerminalManager] Failed to spawn terminal:",M),alert(`Failed to create terminal: ${M.error}`);return}const n=await e.json(),v={id:crypto.randomUUID(),port:n.port,title:`Terminal ${t.length+1}`,url:n.url};a(0,t=[...t,v]),a(1,h=v.id)}catch(e){console.error("[TerminalManager] Error creating terminal:",e),alert("Failed to create terminal")}finally{a(2,d=!1)}}}async function m(e){if(e.isBigBrother&&(o=null),t.length===1){await w(),e.isBigBrother||await D(e.port),a(0,t=t.filter(v=>v.id!==e.id)),t.length>0&&a(1,h=t[0].id);return}e.isBigBrother||await D(e.port);const n=t.findIndex(v=>v.id===e.id);if(a(0,t=t.filter(v=>v.id!==e.id)),h===e.id){const v=Math.max(0,n-1);a(1,h=t[v]?.id||null)}}async function D(e){try{await R(`/api/terminal/kill/${e}`,{method:"POST"})}catch(n){console.error(`[TerminalManager] Error killing terminal on port ${e}:`,n)}}function E(e){a(1,h=e)}function x(e,n){(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),E(n))}function T(e,n){(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),m(n))}return[t,h,d,w,m,E,x,T,e=>m(e),(e,n)=>T(n,e),e=>E(e.id),(e,n)=>x(n,e.id)]}class be extends te{constructor(l){super(),le(this,l,ve,_e,ae,{})}}export{be as default};
