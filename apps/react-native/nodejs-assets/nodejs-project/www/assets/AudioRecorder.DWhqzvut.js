import{S as ae,i as le,s as re,n as L,d as u,c as S,p as G,a as j,b as n,e as h,f as g,g as X,h as y,q as U,j as p,k as N,t as V,l as ne,x as W,v as oe}from"./api-config.B-uR5Kyo.js";function ie(l){let e,t=l[1]?"Resume":"Pause",s,a,r,o="Stop",m,E;return{c(){e=p("button"),s=V(t),a=N(),r=p("button"),r.textContent=o,this.h()},l(i){e=h(i,"BUTTON",{class:!0});var c=g(e);s=U(c,t),c.forEach(u),a=y(i),r=h(i,"BUTTON",{class:!0,"data-svelte-h":!0}),X(r)!=="svelte-1dw9aj7"&&(r.textContent=o),this.h()},h(){S(e,"class","btn svelte-603ttn"),S(r,"class","btn danger svelte-603ttn")},m(i,c){j(i,e,c),n(e,s),j(i,a,c),j(i,r,c),m||(E=[W(e,"click",l[7]),W(r,"click",l[8])],m=!0)},p(i,c){c&2&&t!==(t=i[1]?"Resume":"Pause")&&G(s,t)},d(i){i&&(u(e),u(a),u(r)),m=!1,oe(E)}}}function ce(l){let e,t="Start",s,a;return{c(){e=p("button"),e.textContent=t,this.h()},l(r){e=h(r,"BUTTON",{class:!0,"data-svelte-h":!0}),X(e)!=="svelte-1xp34km"&&(e.textContent=t),this.h()},h(){S(e,"class","btn primary svelte-603ttn")},m(r,o){j(r,e,o),s||(a=W(e,"click",l[6]),s=!0)},p:L,d(r){r&&u(e),s=!1,a()}}}function se(l){let e,t;return{c(){e=p("div"),t=V(l[2]),this.h()},l(s){e=h(s,"DIV",{class:!0});var a=g(e);t=U(a,l[2]),a.forEach(u),this.h()},h(){S(e,"class","error svelte-603ttn")},m(s,a){j(s,e,a),n(e,t)},p(s,a){a&4&&G(t,s[2])},d(s){s&&u(e)}}}function de(l){let e,t,s,a="Record from Microphone",r,o,m,E,i,c,R,C,_,q,D,w,O,b,P,A,M,B,T,I,F;function Y(d,f){return d[0]?ie:ce}let z=Y(l),k=z(l),v=l[2]&&se(l);return{c(){e=p("div"),t=p("div"),s=p("h3"),s.textContent=a,r=N(),o=p("div"),m=p("span"),i=N(),c=p("span"),R=V(l[5]),C=N(),_=p("div"),k.c(),q=N(),D=p("div"),w=p("div"),O=V("Uploaded: "),b=p("strong"),P=V(l[3]),A=N(),M=p("div"),B=V("Failed: "),T=p("strong"),I=V(l[4]),F=N(),v&&v.c(),this.h()},l(d){e=h(d,"DIV",{class:!0});var f=g(e);t=h(f,"DIV",{class:!0});var H=g(t);s=h(H,"H3",{"data-svelte-h":!0}),X(s)!=="svelte-1tzpq85"&&(s.textContent=a),r=y(H),o=h(H,"DIV",{class:!0});var Q=g(o);m=h(Q,"SPAN",{class:!0}),g(m).forEach(u),i=y(Q),c=h(Q,"SPAN",{class:!0});var x=g(c);R=U(x,l[5]),x.forEach(u),Q.forEach(u),H.forEach(u),C=y(f),_=h(f,"DIV",{class:!0});var $=g(_);k.l($),$.forEach(u),q=y(f),D=h(f,"DIV",{class:!0});var Z=g(D);w=h(Z,"DIV",{});var J=g(w);O=U(J,"Uploaded: "),b=h(J,"STRONG",{});var ee=g(b);P=U(ee,l[3]),ee.forEach(u),J.forEach(u),A=y(Z),M=h(Z,"DIV",{});var K=g(M);B=U(K,"Failed: "),T=h(K,"STRONG",{class:!0});var te=g(T);I=U(te,l[4]),te.forEach(u),K.forEach(u),Z.forEach(u),F=y(f),v&&v.l(f),f.forEach(u),this.h()},h(){S(m,"class",E="dot "+(l[0]?l[1]?"paused":"on":"off")+" svelte-603ttn"),S(c,"class","time svelte-603ttn"),S(o,"class","status svelte-603ttn"),S(t,"class","header svelte-603ttn"),S(_,"class","controls svelte-603ttn"),S(T,"class","err svelte-603ttn"),S(D,"class","metrics svelte-603ttn"),S(e,"class","recorder svelte-603ttn")},m(d,f){j(d,e,f),n(e,t),n(t,s),n(t,r),n(t,o),n(o,m),n(o,i),n(o,c),n(c,R),n(e,C),n(e,_),k.m(_,null),n(e,q),n(e,D),n(D,w),n(w,O),n(w,b),n(b,P),n(D,A),n(D,M),n(M,B),n(M,T),n(T,I),n(e,F),v&&v.m(e,null)},p(d,[f]){f&3&&E!==(E="dot "+(d[0]?d[1]?"paused":"on":"off")+" svelte-603ttn")&&S(m,"class",E),f&32&&G(R,d[5]),z===(z=Y(d))&&k?k.p(d,f):(k.d(1),k=z(d),k&&(k.c(),k.m(_,null))),f&8&&G(P,d[3]),f&16&&G(I,d[4]),d[2]?v?v.p(d,f):(v=se(d),v.c(),v.m(e,null)):v&&(v.d(1),v=null)},i:L,o:L,d(d){d&&u(e),k.d(),v&&v.d()}}}const ue=3e4;function fe(l){const e=Math.floor(l/1e3),t=Math.floor(e/60),s=e%60;return`${String(t).padStart(2,"0")}:${String(s).padStart(2,"0")}`}function ve(l,e,t){let s=null,a=null,r=!1,o=!1,m="",E=0,i=0,c=0,R=0,C="00:00",_=null;function q(){r&&t(5,C=fe(Date.now()-R))}async function D(){try{if(t(2,m=""),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){t(2,m="Microphone not available in this browser.");return}s=await navigator.mediaDevices.getUserMedia({audio:!0}),a=new MediaRecorder(s,{mimeType:"audio/webm"}),c=0,t(3,E=0),t(4,i=0),a.ondataavailable=async b=>{if(!b.data||b.data.size===0)return;c++;const P=c,A=b.data,B=`mic-${new Date().toISOString().replace(/[-:T.Z]/g,"").slice(0,14)}-${P}.webm`,T=new FormData;T.append("audio",A,B);try{const I=await ne("/api/audio/upload",{method:"POST",body:T}),F=await I.json();if(!I.ok||!F.success)throw new Error(F.error||"Upload failed");t(3,E++,E)}catch{t(4,i++,i)}},a.start(ue),t(0,r=!0),t(1,o=!1),R=Date.now(),t(5,C="00:00"),_&&clearInterval(_),_=setInterval(q,1e3)}catch(b){t(2,m=b.message),O()}}function w(){a&&(o?(a.resume(),t(1,o=!1)):(a.pause(),t(1,o=!0)))}function O(){try{a&&r&&a.stop(),s&&s.getTracks().forEach(b=>b.stop())}catch{}t(0,r=!1),t(1,o=!1),_&&(clearInterval(_),_=null)}return[r,o,m,E,i,C,D,w,O]}class pe extends ae{constructor(e){super(),le(this,e,ve,de,re,{})}}export{pe as default};
