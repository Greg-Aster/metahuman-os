var L=function(w){var E={};function y(d){if(E[d])return E[d].exports;var g=E[d]={i:d,l:!1,exports:{}};return w[d].call(g.exports,g,g.exports,y),g.l=!0,g.exports}return y.m=w,y.c=E,y.d=function(d,g,f){y.o(d,g)||Object.defineProperty(d,g,{configurable:!1,enumerable:!0,get:f})},y.n=function(d){var g=d&&d.__esModule?function(){return d.default}:function(){return d};return y.d(g,"a",g),g},y.o=function(d,g){return Object.prototype.hasOwnProperty.call(d,g)},y.p="",y(y.s=3)}([function(w,E,y){y.d(E,"a",function(){return d});var d={NODE_TITLE_HEIGHT:16,NODE_SLOT_HEIGHT:15,NODE_WIDTH:140,NODE_MIN_WIDTH:50,NODE_COLLAPSED_RADIUS:10,NODE_COLLAPSED_WIDTH:80,CANVAS_GRID_SIZE:10,NODE_TITLE_COLOR:"#222",NODE_DEFAULT_COLOR:"#999",NODE_DEFAULT_BGCOLOR:"#444",NODE_DEFAULT_BOXCOLOR:"#AEF",NODE_DEFAULT_SHAPE:"box",MAX_NUMBER_OF_NODES:1e3,DEFAULT_POSITION:[100,100],node_images_path:"",STATUS_STOPPED:1,STATUS_RUNNING:2,EVENT:-1,ACTION:-1,INPUT:1,OUTPUT:2,ALWAYS:0,ON_EVENT:1,NEVER:2}},function(w,E,y){y.d(E,"f",function(){return h}),y.d(E,"d",function(){return n}),y.d(E,"b",function(){return f}),y.d(E,"c",function(){return g}),y.d(E,"a",function(){return t}),y.d(E,"e",function(){return e});var d=y(0),g=function(){return Date.now()},f=function(i,o){return Math.sqrt((o[0]-i[0])*(o[0]-i[0])+(o[1]-i[1])*(o[1]-i[1]))};function n(i,o,r,a,s,l){return r<i&&r+s>i&&a<o&&a+l>o}function h(i,o){return!(i[0]>o[2]||i[1]>o[3]||i[2]<o[0]||i[3]<o[1])}var t=function(i,o){if(i==null)return null;var r=JSON.parse(JSON.stringify(i));if(!o)return r;for(var a in r)o[a]=r[a];return o},e=function(i,o){return!i||!o||i==i||i!==d.a.EVENT&&o!==d.a.EVENT&&i.toLowerCase()==o.toLowerCase()}},function(w,E,y){y.d(E,"a",function(){return a}),y.d(E,"e",function(){return r}),y.d(E,"f",function(){return o}),y.d(E,"d",function(){return t});var d=y(4),g=y(6),f=y(1),n=y(0);y.d(E,"c",function(){return g.a}),y.d(E,"b",function(){return d.a});const h=!1,t=!0,e={},i={};var o=function(s,l){if(!l.prototype)throw new Error("Cannot register a simple object, it must be a class with a prototype");l.type=s,s.split("/");var u=l.constructor.name,p=s.lastIndexOf("/");if(l.category=s.substr(0,p),l.title||(l.title=u),l.prototype)for(var c in g.a.prototype)l.prototype[c]||(l.prototype[c]=g.a.prototype[c]);if(e[s]=l,l.constructor.name,l.prototype.onPropertyChange&&console.warn("LiteGraph node class "+s+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),l.supported_extensions)for(var c in l.supported_extensions)i[l.supported_extensions[c].toLowerCase()]=l},r=function(s,l,u){var p=e[s];if(!p)return null;l=l||p.title||s;var c=new p(l);if(c.type=s,c.title||(c.title=l),c.properties||(c.properties={}),c.properties_info||(c.properties_info=[]),c.flags||(c.flags={}),c.size||(c.size=c.computeSize()),c.pos||(c.pos=n.a.DEFAULT_POSITION.concat()),c.mode||(c.mode=n.a.ALWAYS),u)for(var v in u)c[v]=u[v];return c};function a(){this.list_of_graphcanvas=null,this.clear()}a.supported_types=["number","string","boolean"],a.prototype.getSupportedTypes=function(){return this.supported_types||a.supported_types},a.prototype.clear=function(){this.stop(),this.status=n.a.STATUS_STOPPED,this.last_node_id=0,this._nodes=[],this._nodes_by_id={},this._nodes_in_order=null,this._nodes_executable=null,this.last_link_id=0,this.links={},this.iteration=0,this.config={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.starttime=0,this.catch_errors=!0,this.global_inputs={},this.global_outputs={},this.debug=!0,this.change(),this.sendActionToCanvas("clear")},a.prototype.attachCanvas=function(s){console.warn("DEPRECATED")},a.prototype.detachCanvas=function(s){console.warn("DEPRECATED")},a.prototype.start=function(s){if(this.status!==n.a.STATUS_RUNNING){this.status=n.a.STATUS_RUNNING,this.onPlayEvent&&this.onPlayEvent(),this.sendEventToAllNodes("onStart"),this.starttime=Object(f.c)(),s=s||1;var l=this;this.execution_timer_id=setInterval(function(){l.runStep(1,!this.catch_errors)},s)}},a.prototype.stop=function(){this.status!==n.a.STATUS_STOPPED&&(this.status=n.a.STATUS_STOPPED,this.onStopEvent&&this.onStopEvent(),this.execution_timer_id!=null&&clearInterval(this.execution_timer_id),this.execution_timer_id=null,this.sendEventToAllNodes("onStop"))},a.prototype.runStep=function(s,l){s=s||1;var u=Object(f.c)();this.globaltime=.001*(u-this.starttime);var p=this._nodes_executable?this._nodes_executable:this._nodes;if(p){if(l){for(var c=0;c<s;c++){for(var v=0,_=p.length;v<_;++v){var C=p[v];C.mode==n.a.ALWAYS&&C.onExecute&&C.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute()}else try{for(var c=0;c<s;c++){for(var v=0,_=p.length;v<_;++v){var C=p[v];C.mode==n.a.ALWAYS&&C.onExecute&&C.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute(),this.errors_in_execution=!1}catch(O){throw this.errors_in_execution=!0,O}var b=Object(f.c)()-u;b==0&&(b=1),this.elapsed_time=.001*b,this.globaltime+=.001*b,this.iteration+=1}},a.prototype.updateExecutionOrder=function(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var s=0;s<this._nodes_in_order.length;++s)this._nodes_in_order[s].onExecute&&this._nodes_executable.push(this._nodes_in_order[s])},a.prototype.computeExecutionOrder=function(s){for(var l=[],u=[],p={},c={},v={},_=0,C=this._nodes.length;_<C;++_){var b=this._nodes[_];if(!(s&&!b.onExecute)){p[b.id]=b;var O=0;if(b.inputs)for(var D=0,I=b.inputs.length;D<I;D++)b.inputs[D]&&b.inputs[D].link!=null&&(O+=1);O==0?u.push(b):v[b.id]=O}}for(;u.length!=0;){var b=u.shift();if(l.push(b),delete p[b.id],b.outputs)for(var _=0;_<b.outputs.length;_++){var T=b.outputs[_];if(!(T==null||T.links==null||T.links.length==0))for(var D=0;D<T.links.length;D++){var A=T.links[D],N=this.links[A];if(N&&!c[N.id]){var M=this.getNodeById(N.target_id);if(M==null){c[N.id]=!0;continue}c[N.id]=!0,v[M.id]-=1,v[M.id]==0&&u.push(M)}}}}for(var _ in p)l.push(p[_]);l.length!=this._nodes.length;for(var _=0;_<l.length;++_)l[_].order=_;return l},a.prototype.getTime=function(){return this.globaltime},a.prototype.getFixedTime=function(){return this.fixedtime},a.prototype.getElapsedTime=function(){return this.elapsed_time},a.prototype.sendEventToAllNodes=function(s,l,u){u=u||n.a.ALWAYS;var p=this._nodes_in_order?this._nodes_in_order:this._nodes;if(p)for(var c=0,v=p.length;c<v;++c){var _=p[c];_[s]&&_.mode==u&&(l===void 0?_[s]():l&&l.constructor===Array?_[s].apply(_,l):_[s](l))}},a.prototype.sendActionToCanvas=function(s,l){if(this.list_of_graphcanvas)for(var u=0;u<this.list_of_graphcanvas.length;++u){var p=this.list_of_graphcanvas[u];p[s]&&p[s].apply(p,l)}},a.prototype.add=function(s,l){if(!(!s||s.id!=-1&&this._nodes_by_id[s.id]!=null)){if(this._nodes.length>=n.a.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";return s.id==null||s.id==-1?s.id=++this.last_node_id:this.last_node_id<s.id&&(this.last_node_id=s.id),s.graph=this,this._nodes.push(s),this._nodes_by_id[s.id]=s,s.onAdded&&s.onAdded(this),this.config.align_to_grid&&s.alignToGrid(),l||this.updateExecutionOrder(),this.onNodeAdded&&this.onNodeAdded(s),this.setDirtyCanvas(!0),this.change(),s}},a.prototype.remove=function(s){if(this._nodes_by_id[s.id]!=null&&!s.ignore_remove){if(s.inputs)for(var l=0;l<s.inputs.length;l++){var u=s.inputs[l];u.link!=null&&s.disconnectInput(l)}if(s.outputs)for(var l=0;l<s.outputs.length;l++){var u=s.outputs[l];u.links!=null&&u.links.length&&s.disconnectOutput(l)}if(s.onRemoved&&s.onRemoved(),s.graph=null,this.list_of_graphcanvas)for(var l=0;l<this.list_of_graphcanvas.length;++l){var p=this.list_of_graphcanvas[l];p.selected_nodes[s.id]&&delete p.selected_nodes[s.id],p.node_dragged==s&&(p.node_dragged=null)}var c=this._nodes.indexOf(s);c!==-1&&this._nodes.splice(c,1),delete this._nodes_by_id[s.id],this.onNodeRemoved&&this.onNodeRemoved(s),this.setDirtyCanvas(!0,!0),this.change(),this.updateExecutionOrder()}},a.prototype.getNodeById=function(s){return s==null?null:this._nodes_by_id[s]},a.prototype.findNodesByClass=function(s){for(var l=[],u=0,p=this._nodes.length;u<p;++u)this._nodes[u].constructor===s&&l.push(this._nodes[u]);return l},a.prototype.findNodesByType=function(l){for(var l=l.toLowerCase(),u=[],p=0,c=this._nodes.length;p<c;++p)this._nodes[p].type.toLowerCase()==l&&u.push(this._nodes[p]);return u},a.prototype.findNodesByTitle=function(s){for(var l=[],u=0,p=this._nodes.length;u<p;++u)this._nodes[u].title==s&&l.push(this._nodes[u]);return l},a.prototype.getNodeOnPos=function(s,l,u){u=u||this._nodes;for(var p=u.length-1;p>=0;p--){var c=u[p];if(c.isPointInsideNode(s,l,2))return c}return null},a.prototype.addGlobalInput=function(s,l,u){this.global_inputs[s]={name:s,type:l,value:u},this.onGlobalInputAdded&&this.onGlobalInputAdded(s,l),this.onGlobalsChange&&this.onGlobalsChange()},a.prototype.setGlobalInputData=function(s,l){var u=this.global_inputs[s];u&&(u.value=l)},a.prototype.getGlobalInputData=function(s){var l=this.global_inputs[s];return l?l.value:null},a.prototype.renameGlobalInput=function(s,l){if(l!==s){if(!this.global_inputs[s])return!1;if(this.global_inputs[l])return console.error("there is already one input with that name"),!1;this.global_inputs[l]=this.global_inputs[s],delete this.global_inputs[s],this.onGlobalInputRenamed&&this.onGlobalInputRenamed(s,l),this.onGlobalsChange&&this.onGlobalsChange()}},a.prototype.changeGlobalInputType=function(s,l){if(!this.global_inputs[s])return!1;this.global_inputs[s].type.toLowerCase()!=l.toLowerCase()&&(this.global_inputs[s].type=l,this.onGlobalInputTypeChanged&&this.onGlobalInputTypeChanged(s,l))},a.prototype.removeGlobalInput=function(s){return this.global_inputs[s]?(delete this.global_inputs[s],this.onGlobalInputRemoved&&this.onGlobalInputRemoved(s),this.onGlobalsChange&&this.onGlobalsChange(),!0):!1},a.prototype.addGlobalOutput=function(s,l,u){this.global_outputs[s]={name:s,type:l,value:u},this.onGlobalOutputAdded&&this.onGlobalOutputAdded(s,l),this.onGlobalsChange&&this.onGlobalsChange()},a.prototype.setGlobalOutputData=function(s,l){var u=this.global_outputs[s];u&&(u.value=l)},a.prototype.getGlobalOutputData=function(s){var l=this.global_outputs[s];return l?l.value:null},a.prototype.renameGlobalOutput=function(s,l){if(!this.global_outputs[s])return!1;if(this.global_outputs[l])return console.error("there is already one output with that name"),!1;this.global_outputs[l]=this.global_outputs[s],delete this.global_outputs[s],this.onGlobalOutputRenamed&&this.onGlobalOutputRenamed(s,l),this.onGlobalsChange&&this.onGlobalsChange()},a.prototype.changeGlobalOutputType=function(s,l){if(!this.global_outputs[s])return!1;this.global_outputs[s].type.toLowerCase()!=l.toLowerCase()&&(this.global_outputs[s].type=l,this.onGlobalOutputTypeChanged&&this.onGlobalOutputTypeChanged(s,l))},a.prototype.removeGlobalOutput=function(s){return this.global_outputs[s]?(delete this.global_outputs[s],this.onGlobalOutputRemoved&&this.onGlobalOutputRemoved(s),this.onGlobalsChange&&this.onGlobalsChange(),!0):!1},a.prototype.setInputData=function(s,l){for(var u=this.findNodesByName(s),p=0,c=u.length;p<c;++p)u[p].setValue(l)},a.prototype.getOutputData=function(s){var l=this.findNodesByName(s);return l.length?m[0].getValue():null},a.prototype.triggerInput=function(s,l){for(var u=this.findNodesByName(s),p=0;p<u.length;++p)u[p].onTrigger(l)},a.prototype.setCallback=function(s,l){for(var u=this.findNodesByName(s),p=0;p<u.length;++p)u[p].setTrigger(l)},a.prototype.connectionChange=function(s){this.updateExecutionOrder(),this.onConnectionChange&&this.onConnectionChange(s),this.sendActionToCanvas("onConnectionChange")},a.prototype.isLive=function(){if(!this.list_of_graphcanvas)return!1;for(var s=0;s<this.list_of_graphcanvas.length;++s){var l=this.list_of_graphcanvas[s];if(l.live_mode)return!0}return!1},a.prototype.change=function(){this.sendActionToCanvas("setDirty",[!0,!0]),this.on_change&&this.on_change(this)},a.prototype.setDirtyCanvas=function(s,l){this.sendActionToCanvas("setDirty",[s,l])},a.prototype.serialize=function(){for(var s=[],l=0,u=this._nodes.length;l<u;++l)s.push(this._nodes[l].serialize());var p=[];for(var l in this.links){var c=this.links[l];p.push([c.id,c.origin_id,c.origin_slot,c.target_id,c.target_slot])}var v={iteration:this.iteration,frame:this.frame,last_node_id:this.last_node_id,last_link_id:this.last_link_id,links:p,config:this.config,nodes:s};return v},a.prototype.configure=function(s,l){l||this.clear();var u=s.nodes;if(s.links&&s.links.constructor===Array){for(var p={},c=0;c<s.links.length;++c){var v=s.links[c];p[v[0]]={id:v[0],origin_id:v[1],origin_slot:v[2],target_id:v[3],target_slot:v[4]}}s.links=p}for(var c in s)this[c]=s[c];var _=!1;this._nodes=[];for(var c=0,C=u.length;c<C;++c){var b=u[c],O=r(b.type,b.title);if(!O){_=!0;continue}O.id=b.id,this.add(O,!0)}for(var c=0,C=u.length;c<C;++c){var b=u[c],O=this.getNodeById(b.id);O&&O.configure(b)}return this.updateExecutionOrder(),this.setDirtyCanvas(!0,!0),_},a.prototype.load=function(s){var l=this,u=new XMLHttpRequest;u.open("GET",s,!0),u.send(null),u.onload=function(p){if(u.status!==200){console.error("Error loading graph:",u.status,u.response);return}var c=JSON.parse(u.response);l.configure(c)},u.onerror=function(p){console.error("Error loading graph:",p)}},a.prototype.onNodeTrace=function(s,l,u){},window!==void 0&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(s){window.setTimeout(s,16.666666666666668)})},function(w,E,y){Object.defineProperty(E,"__esModule",{value:!0});var d=y(2),g=y(7);y.d(E,"registerNodeType",function(){return d.f}),y.d(E,"createNode",function(){return d.e}),y.d(E,"LGraphCanvas",function(){return d.b}),y.d(E,"LGraphNode",function(){return d.c}),y.d(E,"LGraph",function(){return d.a}),Object(d.f)("basic/time",g.g),Object(d.f)("basic/script",g.e),Object(d.f)("graph/subgraph",g.f),Object(d.f)("graph/input",g.c),Object(d.f)("graph/output",g.d),Object(d.f)("basic/const",g.b),Object(d.f)("basic/watch",g.h),Object(d.f)("basic/console",g.a)},function(w,E,y){y.d(E,"a",function(){return n});var d=y(0),g=y(5),f=y(1),n=function(t,e,i){i=i||{},t&&t.constructor===String&&(t=document.querySelector(t)),this.max_zoom=10,this.min_zoom=.1,this.title_text_font="bold 14px Arial",this.inner_text_font="normal 12px Arial",this.default_link_color="#AAC",this.highquality_render=!0,this.editor_alpha=1,this.pause_rendering=!1,this.render_shadows=!0,this.clear_background=!0,this.render_only_selected=!0,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.always_render_background=!1,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!0,this.render_connection_arrows=!0,this.connections_width=3,this.background_image="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",this.graphStack=[e],this.setCanvas(t),this.clear(),i.skip_render||this.startRendering(),this.autoresize=i.autoresize};n.link_type_colors={"-1":"#F85",number:"#AAC",node:"#DCA"},n.prototype.clear=function(){this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.scale=1,this.offset=[0,0],this.selected_nodes={},this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.onClear&&this.onClear()},n.prototype.setGraph=function(t,e){var i=this.getGraph();i!=t&&(e||this.clear(),this.setDirty(!0,!0))},n.prototype.openSubgraph=function(t){if(!t)throw new Error("graph cannot be null");this.clear(),this.graphStack.push(t),this.setDirty(!0,!0)},n.prototype.closeSubgraph=function(){this.graphStack.length>1&&this.graphStack.pop(),this.setDirty(!0,!0)},n.prototype.setCanvas=function(t,e){if(t&&t.constructor===String&&(t=document.getElementById(t),!t))throw new Error("Error creating LiteGraph canvas: Canvas not found");if(t!==this.canvas&&(!t&&this.canvas&&(e||this.unbindEvents()),this.canvas=t,!!t)){if(t.className+=" lgraphcanvas",t.data=this,this.bgcanvas=null,this.bgcanvas||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height),t.getContext==null)throw t.localName!="canvas"?"Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+t.localName:new Error("This browser doesnt support Canvas");var i=this.ctx=t.getContext("2d");i==null&&(console.warn("This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),e||this.bindEvents()}},n.prototype._doNothing=function(e){return e.preventDefault(),!1},n.prototype._doReturnTrue=function(e){return e.preventDefault(),!0},n.prototype.bindEvents=function(){if(this._events_binded){console.warn("LGraphCanvas: events already binded");return}var t=this.canvas;this._mousedown_callback=this.processMouseDown.bind(this),this._mousewheel_callback=this.processMouseWheel.bind(this),t.addEventListener("mousedown",this._mousedown_callback,!0),t.addEventListener("mousemove",this._mousemove_callback),t.addEventListener("mousewheel",this._mousewheel_callback,!1),t.addEventListener("contextmenu",this._doNothing),t.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1),t.addEventListener("touchstart",this.touchHandler,!0),t.addEventListener("touchmove",this.touchHandler,!0),t.addEventListener("touchend",this.touchHandler,!0),t.addEventListener("touchcancel",this.touchHandler,!0),this._key_callback=this.processKey.bind(this),t.addEventListener("keydown",this._key_callback),t.addEventListener("keyup",this._key_callback),this._ondrop_callback=this.processDrop.bind(this),t.addEventListener("dragover",this._doNothing,!1),t.addEventListener("dragend",this._doNothing,!1),t.addEventListener("drop",this._ondrop_callback,!1),t.addEventListener("dragenter",this._doReturnTrue,!1),this._events_binded=!0},n.prototype.unbindEvents=function(){if(!this._events_binded){console.warn("LGraphCanvas: no events binded");return}this.canvas.removeEventListener("mousedown",this._mousedown_callback),this.canvas.removeEventListener("mousewheel",this._mousewheel_callback),this.canvas.removeEventListener("DOMMouseScroll",this._mousewheel_callback),this.canvas.removeEventListener("keydown",this._key_callback),this.canvas.removeEventListener("keyup",this._key_callback),this.canvas.removeEventListener("contextmenu",this._doNothing),this.canvas.removeEventListener("drop",this._ondrop_callback),this.canvas.removeEventListener("dragenter",this._doReturnTrue),this.canvas.removeEventListener("touchstart",this.touchHandler),this.canvas.removeEventListener("touchmove",this.touchHandler),this.canvas.removeEventListener("touchend",this.touchHandler),this.canvas.removeEventListener("touchcancel",this.touchHandler),this._mousedown_callback=null,this._mousewheel_callback=null,this._key_callback=null,this._ondrop_callback=null,this._events_binded=!1},n.getFileExtension=function(t){var e=t.indexOf("?");e!=-1&&(t=t.substr(0,e));var i=t.lastIndexOf(".");return i==-1?"":t.substr(i+1).toLowerCase()},n.prototype.enableWebGL=function(){if(typeof GL===void 0)throw"litegl.js must be included to use a WebGL canvas";if(typeof enableWebGLCanvas===void 0)throw"webglCanvas.js must be included to use this feature";this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl},n.prototype.setDirty=function(t,e){t&&(this.dirty_canvas=!0),e&&(this.dirty_bgcanvas=!0)},n.prototype.getCanvasWindow=function(){if(!this.canvas)return window;var t=this.canvas.ownerDocument;return t.defaultView||t.parentWindow},n.prototype.startRendering=function(){if(this.is_rendering)return;this.is_rendering=!0,t.call(this);function t(){this.pause_rendering||this.draw();var e=this.getCanvasWindow();this.is_rendering&&e.requestAnimationFrame(t.bind(this))}},n.prototype.stopRendering=function(){this.is_rendering=!1},n.prototype.getGraph=function(){var t=this.graphStack.length-1;if(t>=0)return this.graphStack[t]},n.prototype.processMouseDown=function(t){var e=this.getGraph();if(e){this.adjustMouseEvent(t);var i=this.getCanvasWindow();i.document,n.active_canvas=this,this.canvas.removeEventListener("mousemove",this._mousemove_callback),i.document.addEventListener("mousemove",this._mousemove_callback,!0),i.document.addEventListener("mouseup",this._mouseup_callback,!0);var o=e.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);if(h(i),t.which===1){if(!t.shiftKey&&(!o||!this.selected_nodes[o.id])){var r=[];for(var a in this.selected_nodes)this.selected_nodes[a]!=o&&r.push(this.selected_nodes[a]);for(var a in r)this.processNodeDeselected(r[a])}var s=!1;if(o&&this.allow_interaction){!this.live_mode&&!o.flags.pinned&&this.bringToFront(o);var l=!1;if(!this.connecting_node&&!o.flags.collapsed&&!this.live_mode){if(o.outputs)for(var a=0,u=o.outputs.length;a<u;++a){var p=o.outputs[a],c=o.getConnectionPos(!1,a);if(Object(f.d)(t.canvasX,t.canvasY,c[0]-10,c[1]-5,20,10)){this.connecting_node=o,this.connecting_output=p,this.connecting_pos=o.getConnectionPos(!1,a),this.connecting_slot=a,l=!0;break}}if(o.inputs)for(var a=0,u=o.inputs.length;a<u;++a){var v=o.inputs[a],c=o.getConnectionPos(!0,a);Object(f.d)(t.canvasX,t.canvasY,c[0]-10,c[1]-5,20,10)&&v.link!==null&&(o.disconnectInput(a),this.dirty_bgcanvas=!0,l=!0)}!l&&Object(f.d)(t.canvasX,t.canvasY,o.pos[0]+o.size[0]-5,o.pos[1]+o.size[1]-5,5,5)&&(this.resizing_node=o,this.canvas.style.cursor="se-resize",l=!0)}if(!l&&Object(f.d)(t.canvasX,t.canvasY,o.pos[0],o.pos[1]-d.a.NODE_TITLE_HEIGHT,d.a.NODE_TITLE_HEIGHT,d.a.NODE_TITLE_HEIGHT)&&(o.collapse(),l=!0),!l){var _=!1,C=Object(f.c)();C-this.last_mouseclick<300&&this.selected_nodes[o.id]&&(o.onDblClick&&o.onDblClick(t),this.processNodeDblClicked(o),_=!0),o.onMouseDown&&o.onMouseDown(t,[t.canvasX-o.pos[0],t.canvasY-o.pos[1]])?_=!0:this.live_mode&&(s=!0,_=!0),_||(this.allow_dragnodes&&(this.node_dragged=o),this.selected_nodes[o.id]||this.processNodeSelected(o,t)),this.dirty_canvas=!0}}else s=!0;s&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else t.which==2||t.which==3&&this.processContextMenu(o,t);return this.last_mouse[0]=t.localX,this.last_mouse[1]=t.localY,this.last_mouseclick=Object(f.c)(),this.canvas_mouse=[t.canvasX,t.canvasY],e.change(),(!i.document.activeElement||i.document.activeElement.nodeName.toLowerCase()!="input"&&i.document.activeElement.nodeName.toLowerCase()!="textarea")&&t.preventDefault(),t.stopPropagation(),this.onMouseDown&&this.onMouseDown(t),!1}},n.prototype.processMouseMove=function(t){var e=this.getGraph();if(this.autoresize&&this.resize(),!!e){n.active_canvas=this,this.adjustMouseEvent(t);var i=[t.localX,t.localY],o=[i[0]-this.last_mouse[0],i[1]-this.last_mouse[1]];if(this.last_mouse=i,this.canvas_mouse=[t.canvasX,t.canvasY],this.dragging_canvas)this.offset[0]+=o[0]/this.scale,this.offset[1]+=o[1]/this.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if(this.allow_interaction){this.connecting_node&&(this.dirty_canvas=!0);for(var r=e.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes),a=0,s=e._nodes.length;a<s;++a)e._nodes[a].mouseOver&&r!=e._nodes[a]&&(e._nodes[a].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(t),this.node_over=null,this.dirty_canvas=!0);if(r){if(r.mouseOver||(r.mouseOver=!0,this.node_over=r,this.dirty_canvas=!0,r.onMouseEnter&&r.onMouseEnter(t)),r.onMouseMove&&r.onMouseMove(t),this.connecting_node){var l=this._highlight_input||[0,0];if(!this.isOverNodeBox(r,t.canvasX,t.canvasY)){var u=this.isOverNodeInput(r,t.canvasX,t.canvasY,l);if(u!=-1&&r.inputs[u]){var p=r.inputs[u].type;Object(f.e)(this.connecting_output.type,p)&&(this._highlight_input=l)}else this._highlight_input=null}}Object(f.d)(t.canvasX,t.canvasY,r.pos[0]+r.size[0]-5,r.pos[1]+r.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor=null}else this.canvas.style.cursor=null;if(this.node_capturing_input&&this.node_capturing_input!=r&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(t),this.node_dragged&&!this.live_mode){for(var a in this.selected_nodes){var r=this.selected_nodes[a];r.pos[0]+=o[0]/this.scale,r.pos[1]+=o[1]/this.scale}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){this.resizing_node.size[0]+=o[0]/this.scale,this.resizing_node.size[1]+=o[1]/this.scale;var c=Math.max(this.resizing_node.inputs?this.resizing_node.inputs.length:0,this.resizing_node.outputs?this.resizing_node.outputs.length:0);this.resizing_node.size[1]<c*d.a.NODE_SLOT_HEIGHT+4&&(this.resizing_node.size[1]=c*d.a.NODE_SLOT_HEIGHT+4),this.resizing_node.size[0]<d.a.NODE_MIN_WIDTH&&(this.resizing_node.size[0]=d.a.NODE_MIN_WIDTH),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return t.preventDefault(),!1}},n.prototype.processMouseUp=function(t){var e=this.getGraph();if(e){var i=this.getCanvasWindow(),o=i.document;if(n.active_canvas=this,o.removeEventListener("mousemove",this._mousemove_callback,!0),this.canvas.addEventListener("mousemove",this._mousemove_callback,!0),o.removeEventListener("mouseup",this._mouseup_callback,!0),this.adjustMouseEvent(t),t.which==1)if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;var r=e.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);if(r)if(this.connecting_output.type==d.a.EVENT&&this.isOverNodeBox(r,t.canvasX,t.canvasY))this.connecting_node.connect(this.connecting_slot,r,d.a.EVENT);else{var a=this.isOverNodeInput(r,t.canvasX,t.canvasY);if(a!=-1)this.connecting_node.connect(this.connecting_slot,r,a);else{var s=r.getInputInfo(0);this.connecting_output.type===d.a.EVENT?this.connecting_node.connect(this.connecting_slot,r,d.a.EVENT):s&&!s.link&&s.type==this.connecting_output.type&&this.connecting_node.connect(this.connecting_slot,r,0)}}this.connecting_output=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else this.resizing_node?(this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.resizing_node=null):this.node_dragged?(this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),e.config.align_to_grid&&this.node_dragged.alignToGrid(),this.node_dragged=null):(this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(t,[t.canvasX-this.node_over.pos[0],t.canvasY-this.node_over.pos[1]]),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(t,[t.canvasX-this.node_capturing_input.pos[0],t.canvasY-this.node_capturing_input.pos[1]]));else t.which==2?(this.dirty_canvas=!0,this.dragging_canvas=!1):t.which==3&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return e.change(),t.stopPropagation(),t.preventDefault(),!1}},n.prototype.processMouseWheel=function(t){var e=this.getGraph();if(!(!e||!this.allow_dragcanvas)){var i=t.wheelDeltaY!=null?t.wheelDeltaY:t.detail*-60;this.adjustMouseEvent(t);var o=this.scale;return i>0?o*=1.1:i<0&&(o*=.9090909090909091),this.setZoom(o,[t.localX,t.localY]),e.change(),t.preventDefault(),!1}},n.prototype.isOverNodeBox=function(t,e,i){var o=d.a.NODE_TITLE_HEIGHT;return!!Object(f.d)(e,i,t.pos[0]+2,t.pos[1]+2-o,o-4,o-4)},n.prototype.isOverNodeInput=function(t,e,i,o){if(t.inputs)for(var r=0,a=t.inputs.length;r<a;++r){t.inputs[r];var s=t.getConnectionPos(!0,r);if(Object(f.d)(e,i,s[0]-10,s[1]-5,20,10))return o&&(o[0]=s[0],o[1]=s[1]),r}return-1},n.prototype.processKey=function(t){var e=this.getGraph();if(e){var i=!1;if(t.type=="keydown"){if(t.keyCode==65&&t.ctrlKey&&(this.selectAllNodes(),i=!0),(t.keyCode==46||t.keyCode==8)&&(this.deleteSelectedNodes(),i=!0),this.selected_nodes)for(var o in this.selected_nodes)this.selected_nodes[o].onKeyDown&&this.selected_nodes[o].onKeyDown(t)}else if(t.type=="keyup"&&this.selected_nodes)for(var o in this.selected_nodes)this.selected_nodes[o].onKeyUp&&this.selected_nodes[o].onKeyUp(t);if(e.change(),i)return t.preventDefault(),!1}},n.prototype.processDrop=function(t){var e=this.getGraph();t.preventDefault(),this.adjustMouseEvent(t);var i=[t.canvasX,t.canvasY],o=e.getNodeOnPos(i[0],i[1]);if(!o){var r=null;this.onDropItem&&(r=this.onDropItem(event)),r||this.checkDropItem(t);return}if(o.onDropFile||o.onDropData){var a=t.dataTransfer.files;if(a&&a.length)for(var s=0;s<a.length;s++){var l=t.dataTransfer.files[0],u=l.name;if(n.getFileExtension(u),o.onDropFile&&o.onDropFile(l),o.onDropData){var p=new FileReader;p.onload=function(v){var _=v.target.result;o.onDropData(_,u,l)};var c=l.type.split("/")[0];c=="text"||c==""?p.readAsText(l):c=="image"?p.readAsDataURL(l):p.readAsArrayBuffer(l)}}}return o.onDropItem&&o.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1},n.prototype.checkDropItem=function(t){var e=this.getGraph();if(t.dataTransfer.files.length){var i=t.dataTransfer.files[0],o=n.getFileExtension(i.name).toLowerCase(),r=node_types_by_file_extension[o];if(r){var a=createNode(r.type);a.pos=[t.canvasX,t.canvasY],e.add(a),a.onDropFile&&a.onDropFile(i)}}},n.prototype.processNodeSelected=function(t,e){t.selected=!0,t.onSelected&&t.onSelected(),e&&e.shiftKey?this.selected_nodes[t.id]=t:(this.selected_nodes={},this.selected_nodes[t.id]=t),this.dirty_canvas=!0,this.onNodeSelected&&this.onNodeSelected(t)},n.prototype.processNodeDeselected=function(t){t.selected=!1,t.onDeselected&&t.onDeselected(),delete this.selected_nodes[t.id],this.onNodeDeselected&&this.onNodeDeselected(t),this.dirty_canvas=!0},n.prototype.processNodeDblClicked=function(t){this.onShowNodePanel&&this.onShowNodePanel(t),this.onNodeDblClicked&&this.onNodeDblClicked(t),this.setDirty(!0)},n.prototype.selectNode=function(t){this.deselectAllNodes(),t&&(!t.selected&&t.onSelected&&t.onSelected(),t.selected=!0,this.selected_nodes[t.id]=t,this.setDirty(!0))},n.prototype.selectAllNodes=function(){for(var t=this.getGraph(),e=0;e<t._nodes.length;++e){var i=t._nodes[e];!i.selected&&i.onSelected&&i.onSelected(),i.selected=!0,this.selected_nodes[t._nodes[e].id]=i}this.setDirty(!0)},n.prototype.deselectAllNodes=function(){for(var t in this.selected_nodes){var e=this.selected_nodes;e.onDeselected&&e.onDeselected(),e.selected=!1}this.selected_nodes={},this.setDirty(!0)},n.prototype.deleteSelectedNodes=function(){var t=this.getGraph();for(var e in this.selected_nodes){var i=this.selected_nodes[e];t.remove(i)}this.selected_nodes={},this.setDirty(!0)},n.prototype.centerOnNode=function(t){this.offset[0]=-t.pos[0]-t.size[0]*.5+this.canvas.width*.5/this.scale,this.offset[1]=-t.pos[1]-t.size[1]*.5+this.canvas.height*.5/this.scale,this.setDirty(!0,!0)},n.prototype.adjustMouseEvent=function(t){var e=this.canvas.getBoundingClientRect();t.localX=t.pageX-e.left,t.localY=t.pageY-e.top,t.canvasX=t.localX/this.scale-this.offset[0],t.canvasY=t.localY/this.scale-this.offset[1]},n.prototype.setZoom=function(t,e){e||(e=[this.canvas.width*.5,this.canvas.height*.5]);var i=this.convertOffsetToCanvas(e);this.scale=t,this.scale>this.max_zoom?this.scale=this.max_zoom:this.scale<this.min_zoom&&(this.scale=this.min_zoom);var o=this.convertOffsetToCanvas(e),r=[o[0]-i[0],o[1]-i[1]];this.offset[0]+=r[0],this.offset[1]+=r[1],this.dirty_canvas=!0,this.dirty_bgcanvas=!0},n.prototype.convertOffsetToCanvas=function(t){return[t[0]/this.scale-this.offset[0],t[1]/this.scale-this.offset[1]]},n.prototype.convertCanvasToOffset=function(t){return[(t[0]+this.offset[0])*this.scale,(t[1]+this.offset[1])*this.scale]},n.prototype.convertEventToCanvas=function(t){var e=this.canvas.getClientRects()[0];return this.convertOffsetToCanvas([t.pageX-e.left,t.pageY-e.top])},n.prototype.bringToFront=function(t){var e=this.getGraph(),i=e._nodes.indexOf(t);i!=-1&&(e._nodes.splice(i,1),e._nodes.push(t))},n.prototype.sendToBack=function(t){var e=this.getGraph(),i=e._nodes.indexOf(t);i!==-1&&(e._nodes.splice(i,1),e._nodes.unshift(t))},n.prototype.computeVisibleNodes=function(){for(var t=this.getGraph(),e=[],i=0,o=t._nodes.length;i<o;++i){var r=t._nodes[i];this.live_mode&&!r.onDrawBackground&&!r.onDrawForeground||Object(f.f)(this.visible_area,r.getBounding())&&e.push(r)}return e},n.prototype.draw=function(t,e){if(this.canvas){var i=Object(f.c)();this.render_time=(i-this.last_draw_time)*.001,this.last_draw_time=i;var o=this.getGraph();if(o){var r=[-this.offset[0],-this.offset[1]],a=[r[0]+this.canvas.width/this.scale,r[1]+this.canvas.height/this.scale];this.visible_area=new Float32Array([r[0],r[1],a[0],a[1]])}(this.dirty_bgcanvas||e||this.always_render_background||o&&o._last_trigger_time&&i-o._last_trigger_time<1e3)&&this.drawBackCanvas(),(this.dirty_canvas||t)&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1}},n.prototype.drawFrontCanvas=function(){var t=this.getGraph();this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var e=this.ctx;if(e){e.start2D&&e.start2D();var i=this.canvas;if(e.restore(),e.setTransform(1,0,0,1,0,0),this.dirty_area&&(e.save(),e.beginPath(),e.rect(this.dirty_area[0],this.dirty_area[1],this.dirty_area[2],this.dirty_area[3]),e.clip()),this.clear_background&&e.clearRect(0,0,i.width,i.height),this.bgcanvas===this.canvas?this.drawBackCanvas():e.drawImage(this.bgcanvas,0,0),this.onRender&&this.onRender(i,e),this.show_info&&this.renderInfo(e),t){e.save(),e.scale(this.scale,this.scale),e.translate(this.offset[0],this.offset[1]);var o=this.computeVisibleNodes();this.visible_nodes=o;for(var r=0;r<o.length;++r){var a=o[r];e.save(),e.translate(a.pos[0],a.pos[1]),this.drawNode(a,e),e.restore()}if(t.config.links_ontop&&(this.live_mode||this.drawConnections(e)),this.connecting_pos!=null){e.lineWidth=this.connections_width;var s=null;switch(this.connecting_output.type){case d.a.EVENT:s="#F85";break;default:s="#AFA"}this.renderLink(e,this.connecting_pos,[this.canvas_mouse[0],this.canvas_mouse[1]],null,!1,null,s),e.beginPath(),this.connecting_output.type===d.a.EVENT?e.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10):e.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,Math.PI*2),e.fill(),e.fillStyle="#ffcc00",this._highlight_input&&(e.beginPath(),e.arc(this._highlight_input[0],this._highlight_input[1],6,0,Math.PI*2),e.fill())}e.restore()}this.dirty_area&&e.restore(),e.finish2D&&e.finish2D(),this.dirty_canvas=!1}},n.prototype.renderInfo=function(t,e,i){e=e||0,i=i||0,t.save(),t.translate(e,i),t.font="10px Arial",t.fillStyle="#888";var o=this.getGraph();o?(t.fillText("T: "+o.globaltime.toFixed(2)+"s",5,13),t.fillText("I: "+o.iteration,5,26),t.fillText("F: "+this.frame,5,39),t.fillText("FPS:"+this.fps.toFixed(2),5,52)):t.fillText("No graph selected",5,13),t.restore()},n.prototype.drawBackCanvas=function(){var t=this.getGraph(),e=this.bgcanvas;(e.width!=this.canvas.width||e.height!=this.canvas.height)&&(e.width=this.canvas.width,e.height=this.canvas.height),this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var i=this.bgctx;if(i.start&&i.start(),this.clear_background&&i.clearRect(0,0,e.width,e.height),i.restore(),i.setTransform(1,0,0,1,0,0),t){if(i.save(),i.scale(this.scale,this.scale),i.translate(this.offset[0],this.offset[1]),this.background_image&&this.scale>.5){if(i.globalAlpha=(1-.5/this.scale)*this.editor_alpha,i.imageSmoothingEnabled=i.mozImageSmoothingEnabled=i.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var o=this;this._bg_img.onload=function(){o.draw(!0,!0)}}var r=null;this._pattern==null&&this._bg_img.width>0?(r=i.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=r):r=this._pattern,r&&(i.fillStyle=r,i.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2]-this.visible_area[0],this.visible_area[3]-this.visible_area[1]),i.fillStyle="transparent"),i.globalAlpha=1,i.imageSmoothingEnabled=i.mozImageSmoothingEnabled=i.imageSmoothingEnabled=!0}this.onBackgroundRender&&this.onBackgroundRender(e,i),i.strokeStyle="#235",i.strokeRect(0,0,e.width,e.height),this.render_connections_shadows?(i.shadowColor="#000",i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=6):i.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(i),i.shadowColor="rgba(0,0,0,0)",i.restore()}i.finish&&i.finish(),this.dirty_bgcanvas=!1,this.dirty_canvas=!0},n.prototype.drawNode=function(t,e){var i=t.color||d.a.NODE_DEFAULT_COLOR,o=!0;if((t.flags.skip_title_render||t.graph.isLive())&&(o=!1),t.mouseOver&&(o=!0),t.mouseOver,t.selected||(this.render_shadows?(e.shadowColor="rgba(0,0,0,0.5)",e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowBlur=3):e.shadowColor="transparent"),this.live_mode){t.flags.collapsed||(e.shadowColor="transparent",t.onDrawForeground&&t.onDrawForeground(e));return}var r=this.editor_alpha;e.globalAlpha=r;var a=t.shape||"box",s=new Float32Array(t.size);t.flags.collapsed&&(s[0]=d.a.NODE_COLLAPSED_WIDTH,s[1]=0),t.flags.clip_area&&(e.save(),a=="box"?(e.beginPath(),e.rect(0,0,s[0],s[1])):a=="round"?e.roundRect(0,0,s[0],s[1],10):a=="circle"&&(e.beginPath(),e.arc(s[0]*.5,s[1]*.5,s[0]*.5,0,Math.PI*2)),e.clip()),this.drawNodeShape(t,e,s,i,t.bgcolor,!o,t.selected),e.shadowColor="transparent",e.textAlign="left",e.font=this.inner_text_font;var l=this.scale>.6,u=this.connecting_output;if(!t.flags.collapsed){if(t.inputs)for(var p=0;p<t.inputs.length;p++){var c=t.inputs[p];e.globalAlpha=r,this.connecting_node&&Object(f.e)(c.type&&u.type)&&(e.globalAlpha=.4*r),e.fillStyle=c.link!=null?"#7F7":"#AAA";var v=t.getConnectionPos(!0,p);if(v[0]-=t.pos[0],v[1]-=t.pos[1],e.beginPath(),c.type===d.a.EVENT?e.rect(v[0]-6+.5,v[1]-5+.5,14,10):e.arc(v[0],v[1],4,0,Math.PI*2),e.fill(),l){var _=c.label!=null?c.label:c.name;_&&(e.fillStyle=i,e.fillText(_,v[0]+10,v[1]+5))}}if(this.connecting_node&&(e.globalAlpha=.4*r),e.lineWidth=1,e.textAlign="right",e.strokeStyle="black",t.outputs)for(var p=0;p<t.outputs.length;p++){var c=t.outputs[p],v=t.getConnectionPos(!1,p);if(v[0]-=t.pos[0],v[1]-=t.pos[1],e.fillStyle=c.links&&c.links.length?"#7F7":"#AAA",e.beginPath(),c.type===d.a.EVENT?e.rect(v[0]-6+.5,v[1]-5+.5,14,10):e.arc(v[0],v[1],4,0,Math.PI*2),e.fill(),e.stroke(),l){var _=c.label!=null?c.label:c.name;_&&(e.fillStyle=i,e.fillText(_,v[0]-10,v[1]+5))}}e.textAlign="left",e.globalAlpha=1,t.onDrawForeground&&t.onDrawForeground(e)}//! collapsed
t.flags.clip_area&&e.restore(),e.globalAlpha=1},n.prototype.drawNodeShape=function(t,e,i,o,r,a,s){e.strokeStyle=o||d.a.NODE_DEFAULT_COLOR,e.fillStyle=r||d.a.NODE_DEFAULT_BGCOLOR;var l=d.a.NODE_TITLE_HEIGHT,u=t.shape||"box";if(u==="box"?(e.beginPath(),e.rect(0,a?0:-l,i[0]+1,a?i[1]:i[1]+l),e.fill(),e.shadowColor="transparent",s&&(e.strokeStyle="#CCC",e.strokeRect(-.5,a?-.5:-l+-.5,i[0]+2,a?i[1]+2:i[1]+l+2-1),e.strokeStyle=o)):t.shape==="round"?(e.roundRect(0,a?0:-l,i[0],a?i[1]:i[1]+l,10),e.fill()):t.shape==="circle"&&(e.beginPath(),e.arc(i[0]*.5,i[1]*.5,i[0]*.5,0,Math.PI*2),e.fill()),e.shadowColor="transparent",t.bgImage&&t.bgImage.width&&e.drawImage(t.bgImage,(i[0]-t.bgImage.width)*.5,(i[1]-t.bgImage.height)*.5),t.bgImageUrl&&!t.bgImage&&(t.bgImage=t.loadImage(t.bgImageUrl)),t.onDrawBackground&&t.onDrawBackground(e),!a){e.fillStyle=o||d.a.NODE_DEFAULT_COLOR;var p=e.globalAlpha;e.globalAlpha=.5*p,u==="box"?(e.beginPath(),e.rect(0,-l,i[0]+1,l),e.fill()):u==="round"&&(e.roundRect(0,-l,i[0],l,10,0),e.fill()),e.fillStyle=t.boxcolor||d.a.NODE_DEFAULT_BOXCOLOR,e.beginPath(),u==="round"?e.arc(l*.5,l*-.5,(l-6)*.5,0,Math.PI*2):e.rect(3,-l+3,l-6,l-6),e.fill(),e.globalAlpha=p,e.font=this.title_text_font;var c=t.getTitle();c&&this.scale>.5&&(e.fillStyle=d.a.NODE_TITLE_COLOR,e.fillText(c,16,13-l))}},n.prototype.drawNodeCollapsed=function(t,e,i,o){e.strokeStyle=i||d.a.NODE_DEFAULT_COLOR,e.fillStyle=o||d.a.NODE_DEFAULT_BGCOLOR;var r=d.a.NODE_COLLAPSED_RADIUS,a=t.shape||"box";a==="circle"?(e.beginPath(),e.arc(t.size[0]*.5,t.size[1]*.5,r,0,Math.PI*2),e.fill(),e.shadowColor="rgba(0,0,0,0)",e.stroke(),e.fillStyle=t.boxcolor||d.a.NODE_DEFAULT_BOXCOLOR,e.beginPath(),e.arc(t.size[0]*.5,t.size[1]*.5,r*.5,0,Math.PI*2),e.fill()):a==="round"?(e.beginPath(),e.roundRect(t.size[0]*.5-r,t.size[1]*.5-r,2*r,2*r,5),e.fill(),e.shadowColor="rgba(0,0,0,0)",e.stroke(),e.fillStyle=t.boxcolor||d.a.NODE_DEFAULT_BOXCOLOR,e.beginPath(),e.roundRect(t.size[0]*.5-r*.5,t.size[1]*.5-r*.5,r,r,2),e.fill()):(e.beginPath(),e.rect(0,0,t.size[0],r*2),e.fill(),e.shadowColor="rgba(0,0,0,0)",e.stroke(),e.fillStyle=t.boxcolor||d.a.NODE_DEFAULT_BOXCOLOR,e.beginPath(),e.rect(r*.5,r*.5,r,r),e.fill())},n.prototype.drawConnections=function(t){var e=this.getGraph(),i=Object(f.c)();t.lineWidth=this.connections_width,t.fillStyle="#AAA",t.strokeStyle="#AAA",t.globalAlpha=this.editor_alpha;for(var o=0,r=e._nodes.length;o<r;++o){var a=e._nodes[o];if(a.inputs&&a.inputs.length)for(var s=0;s<a.inputs.length;++s){var l=a.inputs[s];if(!(!l||l.link==null)){var u=l.link,p=e.links[u];if(p){var c=e.getNodeById(p.origin_id);if(c!=null){var v=p.origin_slot,_=null;if(v===-1?_=[c.pos[0]+10,c.pos[1]+10]:_=c.getConnectionPos(!1,v),this.renderLink(t,_,a.getConnectionPos(!0,s),p),p&&p._last_time&&i-p._last_time<1e3){var C=2-(i-p._last_time)*.002,b="rgba(255,255,255, "+C.toFixed(2)+")";this.renderLink(t,_,a.getConnectionPos(!0,s),p,!0,C,b)}}}}}}t.globalAlpha=1},n.prototype.renderLink=function(t,e,i,o,r,a,s){if(!this.highquality_render){t.beginPath(),t.moveTo(e[0],e[1]),t.lineTo(i[0],i[1]),t.stroke();return}var l=Object(f.b)(e,i);if(this.render_connections_border&&this.scale>.6&&(t.lineWidth=this.connections_width+4),!s&&o&&(s=n.link_type_colors[o.type]),s||(s=this.default_link_color),t.beginPath(),this.render_curved_connections?(t.moveTo(e[0],e[1]),t.bezierCurveTo(e[0]+l*.25,e[1],i[0]-l*.25,i[1],i[0],i[1])):(t.moveTo(e[0]+10,e[1]),t.lineTo((e[0]+10+(i[0]-10))*.5,e[1]),t.lineTo((e[0]+10+(i[0]-10))*.5,i[1]),t.lineTo(i[0]-10,i[1])),this.render_connections_border&&this.scale>.6&&!r&&(t.strokeStyle="rgba(0,0,0,0.5)",t.stroke()),t.lineWidth=this.connections_width,t.fillStyle=t.strokeStyle=s,t.stroke(),this.render_connection_arrows&&this.scale>=.6&&this.render_connection_arrows&&this.scale>.6){var u=this.computeConnectionPoint(e,i,.5),p=this.computeConnectionPoint(e,i,.51),c=0;this.render_curved_connections?c=-Math.atan2(p[0]-u[0],p[1]-u[1]):c=i[1]>e[1]?0:Math.PI,t.save(),t.translate(u[0],u[1]),t.rotate(c),t.beginPath(),t.moveTo(-5,-5),t.lineTo(0,5),t.lineTo(5,-5),t.fill(),t.restore()}if(a)for(var v=0;v<5;++v){var _=(Object(f.c)()*.001+v*.2)%1,u=this.computeConnectionPoint(e,i,_);t.beginPath(),t.arc(u[0],u[1],5,0,2*Math.PI),t.fill()}},n.prototype.computeConnectionPoint=function(t,e,i){var o=Object(f.b)(t,e),r=t,a=[t[0]+o*.25,t[1]],s=[e[0]-o*.25,e[1]],l=e,u=(1-i)*(1-i)*(1-i),p=3*((1-i)*(1-i))*i,c=3*(1-i)*(i*i),v=i*i*i,_=u*r[0]+p*a[0]+c*s[0]+v*l[0],C=u*r[1]+p*a[1]+c*s[1]+v*l[1];return[_,C]},n.prototype.resize=function(t,e){if(!t&&!e){var i=this.canvas.parentNode;t=i.offsetWidth,e=i.offsetHeight}this.canvas.width===t&&this.canvas.height===e||(this.canvas.width=t,this.canvas.height=e,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))},n.prototype.switchLiveMode=function(t){if(!t){this.live_mode=!this.live_mode,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;return}var e=this,i=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var o=setInterval(function(){e.editor_alpha*=i,e.dirty_canvas=!0,e.dirty_bgcanvas=!0,i<1&&e.editor_alpha<.01&&(clearInterval(o),i<1&&(e.live_mode=!0)),i>1&&e.editor_alpha>.99&&(clearInterval(o),e.editor_alpha=1)},1)},n.prototype.onNodeSelectionChange=function(t){},n.prototype.touchHandler=function(t){var e=t.changedTouches,i=e[0],o="";switch(t.type){case"touchstart":o="mousedown";break;case"touchmove":o="mousemove";break;case"touchend":o="mouseup";break;default:return}var r=this.getCanvasWindow(),a=r.document,s=a.createEvent("MouseEvent");s.initMouseEvent(o,!0,!0,r,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),i.target.dispatchEvent(s),t.preventDefault()},n.onMenuAdd=function(t,e,i,o){var r=n.active_canvas,a=r.getCanvasWindow(),s=getNodeTypesCategories(),l=[];for(var u in s)s[u]&&l.push({value:s[u],content:s[u],has_submenu:!0});var p=new g.a(l,{event:i,callback:c,parentMenu:o},a);function c(_,C,b){var O=_.value,D=getNodeTypesInCategory(O),I=[];for(var T in D)I.push({content:D[T].title,value:D[T].type});return new g.a(I,{event:b,callback:v,parentMenu:p},a),!1}function v(_,C){var b=o.getFirstEvent(),O=createNode(_.value);O&&(O.pos=r.convertEventToCanvas(b),r.graph.add(O))}return!1},n.onMenuCollapseAll=function(){},n.onMenuNodeEdit=function(){},n.showMenuNodeOptionalInputs=function(t,e,i,o,r){if(!r)return;var a=this,s=n.active_canvas,l=s.getCanvasWindow(),u=r.optional_inputs;r.onGetInputs&&(u=r.onGetInputs());var p=[];if(u)for(var c in u){var v=u[c];if(!v){p.push(null);continue}var _=v[0];v[2]&&v[2].label&&(_=v[2].label),p.push({content:_,value:v})}if(this.onMenuNodeInputs&&(p=this.onMenuNodeInputs(p)),!p.length)return;new g.a(p,{event:i,callback:C,parentMenu:o,node:r},l);function C(b,O,D){r&&(b.callback&&b.callback.call(a,r,b,O,D),b.value&&r.addInput(b.value[0],b.value[1],b.value[2]))}return!1},n.showMenuNodeOptionalOutputs=function(t,u,i,o,r){if(!r)return;var a=this,s=n.active_canvas,l=s.getCanvasWindow(),u=r.optional_outputs;r.onGetOutputs&&(u=r.onGetOutputs());var p=[];if(u)for(var c in u){var v=u[c];if(!v){p.push(null);continue}if(r.findOutputSlot(v[0])==-1){var _=v[0];v[2]&&v[2].label&&(_=v[2].label);var C={content:_,value:v};v[1]===d.a.EVENT&&(C.className="event"),p.push(C)}}if(this.onMenuNodeOutputs&&(p=this.onMenuNodeOutputs(p)),!p.length)return;new g.a(p,{event:i,callback:b,parentMenu:o,node:r},l);function b(O,D,I){if(r&&(O.callback&&O.callback.call(a,r,O,D,I),!!O.value)){var T=O.value[1];if(T&&(T.constructor===Object||T.constructor===Array)){var A=[];for(var N in T)A.push({content:N,value:T[N]});return new g.a(A,{event:D,callback:b,parentMenu:o,node:r}),!1}else r.addOutput(O.value[0],O.value[1],O.value[2])}}return!1},n.onShowMenuNodeProperties=function(t,e,i,o,r){if(!r||!r.properties)return;var a=n.active_canvas,s=a.getCanvasWindow(),l=[];for(var u in r.properties){var t=r.properties[u]!==void 0?r.properties[u]:" ";t=n.decodeHTML(t),l.push({content:"<span class='property_name'>"+u+"</span><span class='property_value'>"+t+"</span>",value:u})}if(!l.length)return;new g.a(l,{event:i,callback:p,parentMenu:o,allow_html:!0,node:r},s);function p(c,v,_,C){if(r){var b=this.getBoundingClientRect();a.showEditPropertyValue(r,c.value,{position:[b.left,b.top]})}}return!1},n.decodeHTML=function(t){var e=document.createElement("div");return e.innerText=t,e.innerHTML},n.onResizeNode=function(t,e,i,o,r){r&&(r.size=r.computeSize(),r.setDirtyCanvas(!0,!0))},n.onShowTitleEditor=function(t,e,i,o,r){var a=document.createElement("div");a.className="graphdialog",a.innerHTML="<span class='name'>Title</span><input autofocus type='text' class='value'/><button>OK</button>";var s=a.querySelector("input");s&&(s.value=r.title,s.addEventListener("keydown",function(O){O.keyCode==13&&(C(),O.preventDefault(),O.stopPropagation())}));var l=n.active_canvas,u=l.canvas,p=u.getBoundingClientRect(),c=-20,v=-20;p&&(c-=p.left,v-=p.top),event?(a.style.left=event.pageX+c+"px",a.style.top=event.pageY+v+"px"):(a.style.left=u.width*.5+c+"px",a.style.top=u.height*.5+v+"px");var _=a.querySelector("button");_.addEventListener("click",C),u.parentNode.appendChild(a);function C(){b(s.value)}function b(O){r.title=O,a.parentNode.removeChild(a),r.setDirtyCanvas(!0,!0)}},n.prototype.showEditPropertyValue=function(t,e,i){if(!t||t.properties[e]===void 0)return;i=i||{};var o="string";t.properties[e]!==null&&(o=typeof t.properties[e]);var r=null;if(t.getPropertyInfo&&(r=t.getPropertyInfo(e)),t.properties_info){for(var a=0;a<t.properties_info.length;++a)if(t.properties_info[a].name==e){r=t.properties_info[a];break}}r!=null&&r.type&&(o=r.type);var s="";if(o=="string"||o=="number")s="<input autofocus type='text' class='value'/>";else if(o=="enum"&&r.values){s="<select autofocus type='text' class='value'>";for(var a in r.values){var l=r.values.constructor===Array?r.values[a]:a;s+="<option value='"+l+"' "+(l==t.properties[e]?"selected":"")+">"+r.values[a]+"</option>"}s+="</select>"}else o=="boolean"&&(s="<input autofocus type='checkbox' class='value' "+(t.properties[e]?"checked":"")+"/>");var u=document.createElement("div");if(u.className="graphdialog",u.innerHTML="<span class='name'>"+e+"</span>"+s+"<button>OK</button>",o=="enum"&&r.values){var p=u.querySelector("select");p.addEventListener("change",function(D){O(D.target.value)})}else if(o=="boolean"){var p=u.querySelector("input");p&&p.addEventListener("click",function(I){O(!!p.checked)})}else{var p=u.querySelector("input");p&&(p.value=t.properties[e]!==void 0?t.properties[e]:"",p.addEventListener("keydown",function(I){I.keyCode==13&&(b(),I.preventDefault(),I.stopPropagation())}))}var c=this.canvas.getClientRects()[0],v=-20,_=-20;c&&(v-=c.left,_-=c.top),i.position?(v+=i.position[0],_+=i.position[1]):i.event?(v+=i.event.pageX,_+=i.event.pageY):(v+=this.canvas.width*.5,_+=this.canvas.height*.5),u.style.left=v+"px",u.style.top=_+"px";var C=u.querySelector("button");C.addEventListener("click",b),this.canvas.parentNode.appendChild(u);function b(){O(p.value)}function O(D){typeof t.properties[e]=="number"&&(D=Number(D)),t.properties[e]=D,t.onPropertyChanged&&t.onPropertyChanged(e,D),u.parentNode.removeChild(u),t.setDirtyCanvas(!0,!0)}},n.onMenuNodeCollapse=function(t,e,i,o,r){r.flags.collapsed=!r.flags.collapsed,r.setDirtyCanvas(!0,!0)},n.onMenuNodePin=function(t,e,i,o,r){r.pin()},n.onMenuNodeMode=function(t,e,i,o,r){var a;new g.a(["Always","On Event","Never"],{event:i,callback:s,parentMenu:a,node:r});function s(l){if(r)switch(l){case"On Event":r.mode=d.a.ON_EVENT;break;case"Never":r.mode=d.a.NEVER;break;case"Always":default:r.mode=d.a.ALWAYS;break}}return!1},n.onMenuNodeColors=function(t,e,i,u,r){if(!r)throw new Error("no node for color");var a=[];for(var s in n.node_colors){var l=n.node_colors[s],t={value:s,content:"<span style='display: block; color:"+l.color+"; background-color:"+l.bgcolor+"'>"+s+"</span>"};a.push(t)}var u=new g.a(a,{event:i,callback:p,parentMenu:u,node:r});function p(c){if(r){var v=n.node_colors[c.value];v&&(r.color=v.color,r.bgcolor=v.bgcolor,r.setDirtyCanvas(!0))}}return!1},n.onMenuNodeShapes=function(t,e,i,a,r){if(!r)throw new Error("no node passed");var a=new g.a(["box","round"],{event:i,callback:s,parentMenu:a,node:r});function s(l){r&&(r.shape=l,r.setDirtyCanvas(!0))}return!1},n.onMenuNodeRemove=function(t,e,i,o,r){if(!r)throw new Error("no node passed");r.removable!=!1&&(r.graph.remove(r),r.setDirtyCanvas(!0,!0))},n.onMenuNodeClone=function(t,e,i,o,r){if(r.clonable!=!1){var a=r.clone();a&&(a.pos=[r.pos[0]+5,r.pos[1]+5],r.graph.add(a),r.setDirtyCanvas(!0,!0))}},n.node_colors={red:{color:"#FAA",bgcolor:"#A44"},green:{color:"#AFA",bgcolor:"#4A4"},blue:{color:"#AAF",bgcolor:"#44A"},white:{color:"#FFF",bgcolor:"#AAA"}},n.prototype.getCanvasMenuOptions=function(){var t=null;if(this.getMenuOptions?t=this.getMenuOptions():(t=[{content:"Add Node",has_submenu:!0,callback:n.onMenuAdd}],this.graphStack.length>0&&(t=[{content:"Close subgraph",callback:this.closeSubgraph.bind(this)},null].concat(t))),this.getExtraMenuOptions){var e=this.getExtraMenuOptions(this,t);e&&(t=t.concat(e))}return t},n.prototype.getNodeMenuOptions=function(t){var e=null;if(t.getMenuOptions?e=t.getMenuOptions(this):e=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:n.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:n.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:n.onShowMenuNodeProperties},null,{content:"Title",callback:n.onShowTitleEditor},{content:"Mode",has_submenu:!0,callback:n.onMenuNodeMode},{content:"Resize",callback:n.onResizeNode},{content:"Collapse",callback:n.onMenuNodeCollapse},{content:"Pin",callback:n.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:n.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:n.onMenuNodeShapes},null],t.getExtraMenuOptions){var i=t.getExtraMenuOptions(this);i&&(i.push(null),e=i.concat(e))}if(t.clonable!==!1&&e.push({content:"Clone",callback:n.onMenuNodeClone}),t.removable!==!1&&e.push(null,{content:"Remove",callback:n.onMenuNodeRemove}),t.onGetInputs){var o=t.onGetInputs();o&&o.length&&(e[0].disabled=!1)}if(t.onGetOutputs){var r=t.onGetOutputs();r&&r.length&&(e[1].disabled=!1)}return t.graph&&t.graph.onGetNodeMenuOptions&&t.graph.onGetNodeMenuOptions(e,t),e},n.prototype.processContextMenu=function(t,e){var i=n.active_canvas,o=i.getCanvasWindow(),r=null,a={event:e,callback:l,node:t},s=null;if(t&&(s=t.getSlotInPosition(e.canvasX,e.canvasY),n.active_node=t),s?(r=s.locked?["Cannot remove"]:{"Remove Slot":s},a.title=s.input?s.input.type:s.output.type,s.input&&s.input.type==EVENT&&(a.title="Event")):r=t?this.getNodeMenuOptions(t):this.getCanvasMenuOptions(),!r)return;new g.a(r,a,o);function l(u,p,c){u&&u==s&&(u.input?t.removeInput(s.slot):u.output&&t.removeOutput(s.slot))}};function h(t){t=t||window;var e=t.document.querySelectorAll(".litecontextmenu");if(e.length){for(var i=[],o=0;o<e.length;o++)i.push(e[o]);for(var o in i)i[o].close?i[o].close():i[o].parentNode&&i[o].parentNode.removeChild(i[o])}}},function(w,E,y){y.d(E,"a",function(){return d});function d(g,f){f=f||{},this.options=f;var n=this;f.parentMenu&&(f.parentMenu.constructor!==this.constructor?(console.error("parentMenu must be of class ContextMenu, ignoring it"),f.parentMenu=null):(this.parentMenu=f.parentMenu,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this)),f.event&&f.event.constructor!==MouseEvent&&f.event.constructor!==CustomEvent&&(console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it."),f.event=null);var h=document.createElement("div");if(h.className="litegraph litecontextmenu litemenubar-panel",h.style.minWidth=100,h.style.minHeight=100,h.style.pointerEvents="none",setTimeout(function(){h.style.pointerEvents="auto"},100),h.addEventListener("mouseup",function(c){return c.preventDefault(),!0},!0),h.addEventListener("contextmenu",function(c){return c.button!==2||c.preventDefault(),!1},!0),h.addEventListener("mousedown",function(c){if(c.button===2)return n.close(),c.preventDefault(),!0},!0),this.root=h,f.title){var t=document.createElement("div");t.className="litemenu-title",t.innerHTML=f.title,h.appendChild(t)}for(var e in g){var i=g.constructor==Array?g[e]:e;i!=null&&i.constructor!==String&&(i=i.content===void 0?String(i):i.content);var o=g[e];this.addItem(i,o,f)}h.addEventListener("mouseleave",function(c){n.lock||n.close(c)});var r=document;f.event&&(r=f.event.target.ownerDocument),r||(r=document),r.body.appendChild(h);var a=f.left||0,s=f.top||0;if(f.event){if(a=f.event.pageX-10,s=f.event.pageY-10,f.title&&(s-=20),f.parentMenu){var l=f.parentMenu.root.getBoundingClientRect();a=l.left+l.width}var u=document.body.getBoundingClientRect(),p=h.getBoundingClientRect();a>u.width-p.width-10&&(a=u.width-p.width-10),s>u.height-p.height-10&&(s=u.height-p.height-10)}h.style.left=a+"px",h.style.top=s+"px"}d.prototype.addItem=function(g,f,n){var h=this;n=n||{};var t=document.createElement("div");t.className="litemenu-entry submenu";var e=!1;f===null?t.classList.add("separator"):(t.innerHTML=f&&f.title?f.title:g,t.value=f,f&&(f.disabled&&(e=!0,t.classList.add("disabled")),(f.submenu||f.has_submenu)&&t.classList.add("has_submenu")),typeof f=="function"?(t.dataset.value=g,t.onclick_callback=f):t.dataset.value=f),this.root.appendChild(t),e||t.addEventListener("click",o),n.autoopen&&t.addEventListener("mouseenter",i);function i(r){var a=this.value;!a||!a.has_submenu||o.call(this,r)}function o(r){var a=this.value,s=!0;if(h.current_submenu&&h.current_submenu.close(r),n.callback){var l=n.callback.call(this,a,n,r,h,n.node);l===!0&&(s=!1)}if(a){if(a.callback&&!n.ignore_item_callbacks&&a.disabled!==!0){var l=a.callback.call(this,a,n,r,h,n.node);l===!0&&(s=!1)}if(a.submenu){if(!a.submenu.options)throw"ContextMenu submenu needs options";new h.constructor(a.submenu.options,{callback:a.submenu.callback,event:r,parentMenu:h,ignore_item_callbacks:a.submenu.ignore_item_callbacks,title:a.submenu.title,autoopen:n.autoopen}),s=!1}}s&&!h.lock&&h.close()}return t},d.prototype.close=function(g,f){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.parentMenu&&!f&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,g===void 0?this.parentMenu.close():g&&!d.isCursorOverElement(g,this.parentMenu.root)&&d.trigger(this.parentMenu.root,"mouseleave",g)),this.current_submenu&&this.current_submenu.close(g,!0)},d.trigger=function(g,f,n,h){var t=document.createEvent("CustomEvent");return t.initCustomEvent(f,!0,!0,n),t.srcElement=h,g.dispatchEvent?g.dispatchEvent(t):g.__events&&g.__events.dispatchEvent(t),t},d.prototype.getTopMenu=function(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this},d.prototype.getFirstEvent=function(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event},d.isCursorOverElement=function(g,f){var n=g.pageX,h=g.pageY,t=f.getBoundingClientRect();return t?h>t.top&&h<t.top+t.height&&n>t.left&&n<t.left+t.width:!1}},function(w,E,y){y.d(E,"a",function(){return f});var d=y(0),g=y(1);function f(n){this._ctor()}f.prototype._ctor=function(n){this.title=n||"Unnamed",this.size=[d.a.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),Object.defineProperty(this,"pos",{set:function(h){!h||!h.length<2||(this._pos[0]=h[0],this._pos[1]=h[1])},get:function(){return this._pos},enumerable:!0}),this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.data=null,this.flags={}},f.prototype.configure=function(n){for(var h in n)if(h!=="console"){if(h==="properties"){for(var t in n.properties)this.properties[t]=n.properties[t],this.onPropertyChanged&&this.onPropertyChanged(t,n.properties[t]);continue}n[h]!=null&&(typeof n[h]=="object"?this[h]&&this[h].configure?this[h].configure(n[h]):this[h]=Object(g.a)(n[h],this[h]):this[h]=n[h])}if(this.onConnectionsChange){if(this.inputs)for(var e=0;e<this.inputs.length;++e){var i=this.inputs[e],o=this.graph.links[i.link];this.onConnectionsChange(d.a.INPUT,e,!0,o,i)}if(this.outputs)for(var e=0;e<this.outputs.length;++e){var r=this.outputs[e];if(r.links)for(var h=0;h<r.links.length;++h){var o=this.graph.links[r.links[h]];this.onConnectionsChange(d.a.OUTPUT,e,!0,o,r)}}}for(var e in this.inputs){var i=this.inputs[e];if(!(!i.link||!i.link.length)){var a=i.link;typeof a=="object"&&(i.link=a[0],this.graph.links[a[0]]={id:a[0],origin_id:a[1],origin_slot:a[2],target_id:a[3],target_slot:a[4]})}}for(var e in this.outputs){var r=this.outputs[e];if(!(!r.links||r.links.length==0))for(var h in r.links){var a=r.links[h];typeof a=="object"&&(r.links[h]=a[0])}}this.onConfigure&&this.onConfigure(n)},f.prototype.serialize=function(){if(this.outputs)for(var n=0;n<this.outputs.length;n++)delete this.outputs[n]._data;var h={id:this.id,title:this.title,type:this.type,pos:this.pos,size:this.size,data:this.data,flags:Object(g.a)(this.flags),inputs:this.inputs,outputs:this.outputs,mode:this.mode};return this.properties&&(h.properties=Object(g.a)(this.properties)),h.type||(h.type=this.constructor.type),this.color&&(h.color=this.color),this.bgcolor&&(h.bgcolor=this.bgcolor),this.boxcolor&&(h.boxcolor=this.boxcolor),this.shape&&(h.shape=this.shape),this.onSerialize&&this.onSerialize(h),h},f.prototype.clone=function(){var n=new f(this.title),h=Object(g.a)(this.serialize());if(h.inputs)for(var t=0;t<h.inputs.length;++t)h.inputs[t].link=null;if(h.outputs)for(var t=0;t<h.outputs.length;++t)h.outputs[t].links&&(h.outputs[t].links.length=0);return delete h.id,n.configure(h),n},f.prototype.toString=function(){return JSON.stringify(this.serialize())},f.prototype.getTitle=function(){return this.title||this.constructor.title},f.prototype.setOutputData=function(n,h){if(this.outputs&&!(n===-1||n>=this.outputs.length)){var t=this.outputs[n];if(t&&(t._data=h,this.outputs[n].links))for(var e=0;e<this.outputs[n].links.length;e++){var i=this.outputs[n].links[e];this.graph.links[i].data=h}}},f.prototype.getInputData=function(n,h){if(this.inputs&&!(n>=this.inputs.length||this.inputs[n].link==null)){var t=this.inputs[n].link,e=this.graph.links[t];if(!h)return e.data;var i=this.graph.getNodeById(e.origin_id);return i&&(i.updateOutputData?i.updateOutputData(e.origin_slot):i.onExecute&&i.onExecute()),e.data}},f.prototype.isInputConnected=function(n){return this.inputs?n<this.inputs.length&&this.inputs[n].link!=null:!1},f.prototype.getInputInfo=function(n){return this.inputs&&n<this.inputs.length?this.inputs[n]:null},f.prototype.getInputNode=function(n){if(!this.inputs||n>=this.inputs.length)return null;var h=this.inputs[n];if(!h||!h.link)return null;var t=this.graph.links[h.link];return t?this.graph.getNodeById(t.origin_id):null},f.prototype.getOutputData=function(n){if(!this.outputs||n>=this.outputs.length)return null;var h=this.outputs[n];return h._data},f.prototype.getOutputInfo=function(n){return this.outputs&&n<this.outputs.length?this.outputs[n]:null},f.prototype.isOutputConnected=function(n){return this.outputs?n<this.outputs.length&&this.outputs[n].links&&this.outputs[n].links.length:null},f.prototype.getOutputNodes=function(n){if(!this.outputs||this.outputs.length===0||n>=this.outputs.length)return null;var h=this.outputs[n];if(!h.links||h.links.length===0)return null;for(var t=[],e=0;e<h.links.length;e++){var i=h.links[e],o=this.graph.links[i];if(o){var r=this.graph.getNodeById(o.target_id);r&&t.push(r)}}return t},f.prototype.trigger=function(n,h){if(!(!this.outputs||!this.outputs.length)){this.graph&&(this.graph._last_trigger_time=Object(g.c)());for(var t=0;t<this.outputs.length;++t){var e=this.outputs[t];if(!(e.type!==d.a.EVENT||n&&e.name!==n)){var i=e.links;if(!(!i||!i.length))for(var o=0;o<i.length;++o){var r=this.graph.links[i[o]];if(r){var a=this.graph.getNodeById(r.target_id);if(a){r._last_time=Object(g.c)();var s=a.inputs[r.target_slot];a.onAction?a.onAction(s.name,h):a.mode===d.a.ON_TRIGGER&&a.onExecute&&a.onExecute(h)}}}}}}},f.prototype.addProperty=function(n,h,t,e){var i={name:n,type:t,default_value:h};if(e)for(var o in e)i[o]=e[o];return this.properties_info||(this.properties_info=[]),this.properties_info.push(i),this.properties||(this.properties={}),this.properties[n]=h,i},f.prototype.addOutput=function(n,h,t){var e={name:n,type:h,links:null};if(t)for(var i in t)e[i]=t[i];return this.outputs||(this.outputs=[]),this.outputs.push(e),this.onOutputAdded&&this.onOutputAdded(e),this.size=this.computeSize(),e},f.prototype.addOutputs=function(n){for(var h=0;h<n.length;++h){var t=n[h],e={name:t[0],type:t[1],link:null};if(n[2])for(var i in t[2])e[i]=t[2][i];this.outputs||(this.outputs=[]),this.outputs.push(e),this.onOutputAdded&&this.onOutputAdded(e)}this.size=this.computeSize()},f.prototype.removeOutput=function(n){this.disconnectOutput(n),this.outputs.splice(n,1),this.size=this.computeSize(),this.onOutputRemoved&&this.onOutputRemoved(n)},f.prototype.addInput=function(n,h,t){h=h||0;var e={name:n,type:h,link:null};if(t)for(var i in t)e[i]=t[i];return this.inputs||(this.inputs=[]),this.inputs.push(e),this.size=this.computeSize(),this.onInputAdded&&this.onInputAdded(e),e},f.prototype.addInputs=function(n){for(var h=0;h<n.length;++h){var t=n[h],e={name:t[0],type:t[1],link:null};if(n[2])for(var i in t[2])e[i]=t[2][i];this.inputs||(this.inputs=[]),this.inputs.push(e),this.onInputAdded&&this.onInputAdded(e)}this.size=this.computeSize()},f.prototype.removeInput=function(n){this.disconnectInput(n),this.inputs.splice(n,1),this.size=this.computeSize(),this.onInputRemoved&&this.onInputRemoved(n)},f.prototype.addConnection=function(n,h,t,e){var i={name:n,type:h,pos:t,direction:e,links:null};return this.connections.push(i),i},f.prototype.computeSize=function(n,h){var t=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1),e=h||new Float32Array([0,0]);t=Math.max(t,1),e[1]=t*14+6;var i=14,o=_(this.title),r=0,a=0;if(this.inputs)for(var s=0,l=this.inputs.length;s<l;++s){var u=this.inputs[s],p=u.label||u.name||"",c=_(p);r<c&&(r=c)}if(this.outputs)for(var s=0,l=this.outputs.length;s<l;++s){var v=this.outputs[s],p=v.label||v.name||"",c=_(p);a<c&&(a=c)}e[0]=Math.max(r+a+10,o),e[0]=Math.max(e[0],d.a.NODE_WIDTH);function _(C){return C?i*C.length*.6:0}return e},f.prototype.getBounding=function(){return new Float32Array([this.pos[0]-4,this.pos[1]-d.a.NODE_TITLE_HEIGHT,this.pos[0]+this.size[0]+4,this.pos[1]+this.size[1]+d.a.NODE_TITLE_HEIGHT])},f.prototype.isPointInsideNode=function(n,h,t){t=t||0;var e=this.graph&&this.graph.isLive()?0:20;if(this.flags.collapsed){if(Object(g.d)(n,h,this.pos[0]-t,this.pos[1]-d.a.NODE_TITLE_HEIGHT-t,d.a.NODE_COLLAPSED_WIDTH+2*t,d.a.NODE_TITLE_HEIGHT+2*t))return!0}else if(this.pos[0]-4-t<n&&this.pos[0]+this.size[0]+4+t>n&&this.pos[1]-e-t<h&&this.pos[1]+this.size[1]+t>h)return!0;return!1},f.prototype.getSlotInPosition=function(n,h){if(this.inputs)for(var t=0,e=this.inputs.length;t<e;++t){var i=this.inputs[t],o=this.getConnectionPos(!0,t);if(Object(g.d)(n,h,o[0]-10,o[1]-5,20,10))return{input:i,slot:t,link_pos:o,locked:i.locked}}if(this.outputs)for(var t=0,e=this.outputs.length;t<e;++t){var r=this.outputs[t],o=this.getConnectionPos(!1,t);if(Object(g.d)(n,h,o[0]-10,o[1]-5,20,10))return{output:r,slot:t,link_pos:o,locked:r.locked}}return null},f.prototype.findInputSlot=function(n){if(!this.inputs)return-1;for(var h=0,t=this.inputs.length;h<t;++h)if(n===this.inputs[h].name)return h;return-1},f.prototype.findOutputSlot=function(n){if(!this.outputs)return-1;for(var h=0,t=this.outputs.length;h<t;++h)if(n===this.outputs[h].name)return h;return-1},f.prototype.connect=function(n,h,t){if(t=t||0,n.constructor===String){if(n=this.findOutputSlot(n),n==-1)return!1}else if(!this.outputs||n>=this.outputs.length)return!1;if(h&&h.constructor===Number&&(h=this.graph.getNodeById(h)),!h)throw new Error("Node not found");if(h===this)return!1;if(t.constructor===String){if(t=h.findInputSlot(t),t===-1)return!1}else{if(t===d.a.EVENT)return!1;if(!h.inputs||t>=h.inputs.length)return!1}h.inputs[t].link!=null&&h.disconnectInput(t),this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this);var e=this.outputs[n];if(h.onConnectInput&&h.onConnectInput(t,e.type,e)===!1)return!1;var i=h.inputs[t];if(Object(g.e)(e.type,i.type)){var o={id:this.graph.last_link_id++,type:i.type,origin_id:this.id,origin_slot:n,target_id:h.id,target_slot:t};this.graph.links[o.id]=o,e.links==null&&(e.links=[]),e.links.push(o.id),h.inputs[t].link=o.id,this.onConnectionsChange&&this.onConnectionsChange(OUTPUT,n,!0,o,e),h.onConnectionsChange&&h.onConnectionsChange(INPUT,t,!0,o,i)}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},f.prototype.disconnectOutput=function(n,h){if(n.constructor===String){if(n=this.findOutputSlot(n),n==-1)return!1}else if(!this.outputs||n>=this.outputs.length)return!1;var t=this.outputs[n];if(!t.links||t.links.length===0)return!1;if(h){if(h.constructor===Number&&(h=this.graph.getNodeById(h)),!h)throw new Error("Target Node not found");for(var e=0,i=t.links.length;e<i;e++){var o=t.links[e],r=this.graph.links[o];if(r.target_id==h.id){t.links.splice(e,1);var a=h.inputs[r.target_slot];a.link=null,delete this.graph.links[o],h.onConnectionsChange&&h.onConnectionsChange(d.a.INPUT,r.target_slot,!1,r,a),this.onConnectionsChange&&this.onConnectionsChange(d.a.OUTPUT,n,!1,r,t);break}}}else{for(var e=0,i=t.links.length;e<i;e++){var o=t.links[e],r=this.graph.links[o],h=this.graph.getNodeById(r.target_id),a=null;h&&(a=h.inputs[r.target_slot],a.link=null),delete this.graph.links[o],h.onConnectionsChange&&h.onConnectionsChange(d.a.INPUT,r.target_slot,!1,r,a),this.onConnectionsChange&&this.onConnectionsChange(d.a.OUTPUT,n,!1,r,t)}t.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},f.prototype.disconnectInput=function(n){if(n.constructor===String){if(n=this.findInputSlot(n),n===-1)return!1}else if(!this.inputs||n>=this.inputs.length)return!1;var h=this.inputs[n];if(!h)return!1;var t=this.inputs[n].link;this.inputs[n].link=null;var e=this.graph.links[t];if(e){var i=this.graph.getNodeById(e.origin_id);if(!i)return!1;var o=i.outputs[e.origin_slot];if(!o||!o.links||o.links.length==0)return!1;for(var r=0,a=o.links.length;r<a;r++){var t=o.links[r],e=this.graph.links[t];if(e.target_id==this.id){o.links.splice(r,1);break}}this.onConnectionsChange&&this.onConnectionsChange(INPUT,n,!1,e,h),i.onConnectionsChange&&i.onConnectionsChange(OUTPUT,r,!1,e,o)}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},f.prototype.getConnectionPos=function(n,h){return this.flags.collapsed?n?[this.pos[0],this.pos[1]-d.a.NODE_TITLE_HEIGHT*.5]:[this.pos[0]+d.a.NODE_COLLAPSED_WIDTH,this.pos[1]-d.a.NODE_TITLE_HEIGHT*.5]:n&&h===-1?[this.pos[0]+10,this.pos[1]+10]:n&&this.inputs.length>h&&this.inputs[h].pos?[this.pos[0]+this.inputs[h].pos[0],this.pos[1]+this.inputs[h].pos[1]]:!n&&this.outputs.length>h&&this.outputs[h].pos?[this.pos[0]+this.outputs[h].pos[0],this.pos[1]+this.outputs[h].pos[1]]:n?[this.pos[0],this.pos[1]+10+h*d.a.NODE_SLOT_HEIGHT]:[this.pos[0]+this.size[0]+1,this.pos[1]+10+h*d.a.NODE_SLOT_HEIGHT]},f.prototype.alignToGrid=function(){this.pos[0]=d.a.CANVAS_GRID_SIZE*Math.round(this.pos[0]/d.a.CANVAS_GRID_SIZE),this.pos[1]=d.a.CANVAS_GRID_SIZE*Math.round(this.pos[1]/d.a.CANVAS_GRID_SIZE)},f.prototype.trace=function(n){this.console||(this.console=[]),this.console.push(n),this.console.length>d.a.MAX_CONSOLE&&this.console.shift(),this.graph.onNodeTrace(this,n)},f.prototype.setDirtyCanvas=function(n,h){this.graph&&this.graph.sendActionToCanvas("setDirty",[n,h])},f.prototype.loadImage=function(n){var h=new Image;h.src=d.a.node_images_path+n,h.ready=!1;var t=this;return h.onload=function(){this.ready=!0,t.setDirtyCanvas(!0)},h},f.prototype.captureInput=function(n){if(!(!this.graph||!this.graph.list_of_graphcanvas))for(var h=this.graph.list_of_graphcanvas,t=0;t<h.length;++t){var e=h[t];!n&&e.node_capturing_input!==this||(e.node_capturing_input=n?this:null)}},f.prototype.collapse=function(){this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0)},f.prototype.pin=function(n){n===void 0?this.flags.pinned=!this.flags.pinned:this.flags.pinned=n},f.prototype.localToScreen=function(n,h,t){return[(n+this.pos[0])*t.scale+t.offset[0],(h+this.pos[1])*t.scale+t.offset[1]]}},function(w,E,y){y.d(E,"g",function(){return t}),y.d(E,"e",function(){return l}),y.d(E,"f",function(){return e}),y.d(E,"c",function(){return i}),y.d(E,"d",function(){return o}),y.d(E,"b",function(){return r}),y.d(E,"h",function(){return a}),y.d(E,"a",function(){return s});var d=y(2),g=y(0);const f=d.e,n=d.a,h=d.c;function t(){this.addOutput("in ms","number"),this.addOutput("in sec","number")}t.title="Time",t.desc="Time",t.prototype.onExecute=function(){this.setOutputData(0,this.graph.globaltime*1e3),this.setOutputData(1,this.graph.globaltime)};function e(){this.size=[120,60],this.subgraph=new n,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.onGlobalInputAdded=this.onSubgraphNewGlobalInput.bind(this),this.subgraph.onGlobalInputRenamed=this.onSubgraphRenamedGlobalInput.bind(this),this.subgraph.onGlobalInputTypeChanged=this.onSubgraphTypeChangeGlobalInput.bind(this),this.subgraph.onGlobalOutputAdded=this.onSubgraphNewGlobalOutput.bind(this),this.subgraph.onGlobalOutputRenamed=this.onSubgraphRenamedGlobalOutput.bind(this),this.subgraph.onGlobalOutputTypeChanged=this.onSubgraphTypeChangeGlobalOutput.bind(this),this.bgcolor="#940"}e.title="Subgraph",e.desc="Graph inside a node",e.prototype.onSubgraphNewGlobalInput=function(u,p){this.addInput(u,p)},e.prototype.onSubgraphRenamedGlobalInput=function(u,p){var c=this.findInputSlot(u);if(c!=-1){var v=this.getInputInfo(c);v.name=p}},e.prototype.onSubgraphTypeChangeGlobalInput=function(u,p){var c=this.findInputSlot(u);if(c!=-1){var v=this.getInputInfo(c);v.type=p}},e.prototype.onSubgraphNewGlobalOutput=function(u,p){this.addOutput(u,p)},e.prototype.onSubgraphRenamedGlobalOutput=function(u,p){var c=this.findOutputSlot(u);if(c!=-1){var v=this.getOutputInfo(c);v.name=p}},e.prototype.onSubgraphTypeChangeGlobalOutput=function(u,p){var c=this.findOutputSlot(u);if(c!=-1){var v=this.getOutputInfo(c);v.type=p}},e.prototype.getExtraMenuOptions=function(u){var p=this;return[{content:"Open",callback:function(){u.openSubgraph(p.subgraph)}}]},e.prototype.onExecute=function(){if(this.inputs)for(var u=0;u<this.inputs.length;u++){var p=this.inputs[u],c=this.getInputData(u);this.subgraph.setGlobalInputData(p.name,c)}if(this.subgraph.runStep(),this.outputs)for(var u=0;u<this.outputs.length;u++){var v=this.outputs[u],c=this.subgraph.getGlobalOutputData(v.name);this.setOutputData(u,c)}},e.prototype.configure=function(u){h.prototype.configure.call(this,u)},e.prototype.serialize=function(){var u=h.prototype.serialize.call(this);return u.subgraph=this.subgraph.serialize(),u},e.prototype.clone=function(){var u=f(this.type),p=this.serialize();return delete p.id,delete p.inputs,delete p.outputs,u.configure(p),u};function i(){var u="input_"+(Math.random()*1e3).toFixed();this.addOutput(u,null),this.properties={name:u,type:null};var p=this;Object.defineProperty(this.properties,"name",{get:function(){return u},set:function(c){if(c!=""){var v=p.getOutputInfo(0);v.name!=c&&(v.name=c,p.graph&&p.graph.renameGlobalInput(u,c),u=c)}},enumerable:!0}),Object.defineProperty(this.properties,"type",{get:function(){return p.outputs[0].type},set:function(c){p.outputs[0].type=c,p.graph&&p.graph.changeGlobalInputType(u,p.outputs[0].type)},enumerable:!0})}i.title="Input",i.desc="Input of the graph",i.prototype.onAdded=function(){this.graph.addGlobalInput(this.properties.name,this.properties.type)},i.prototype.onExecute=function(){var u=this.properties.name;vardata=this.graph.global_inputs[u],data&&this.setOutputData(0,data.value)};function o(){var u="output_"+(Math.random()*1e3).toFixed();this.addInput(u,null),this.properties={name:u,type:null};var p=this;Object.defineProperty(this.properties,"name",{get:function(){return u},set:function(c){if(c!=""){var v=p.getInputInfo(0);v.name!=c&&(v.name=c,p.graph&&p.graph.renameGlobalOutput(u,c),u=c)}},enumerable:!0}),Object.defineProperty(this.properties,"type",{get:function(){return p.inputs[0].type},set:function(c){p.inputs[0].type=c,p.graph&&p.graph.changeGlobalInputType(u,p.inputs[0].type)},enumerable:!0})}o.title="Ouput",o.desc="Output of the graph",o.prototype.onAdded=function(){this.graph.addGlobalOutput(this.properties.name,this.properties.type)},o.prototype.onExecute=function(){this.graph.setGlobalOutputData(this.properties.name,this.getInputData(0))};function r(){this.addOutput("value","number"),this.addProperty("value",1),this.editable={property:"value",type:"number"}}r.title="Const",r.desc="Constant value",r.prototype.setValue=function(u){typeof u=="string"&&(u=parseFloat(u)),this.properties.value=u,this.setDirtyCanvas(!0)},r.prototype.onExecute=function(){this.setOutputData(0,parseFloat(this.properties.value))},r.prototype.onDrawBackground=function(u){this.outputs[0].label=this.properties.value.toFixed(3)},r.prototype.onWidget=function(u,p){p.name=="value"&&this.setValue(p.value)};function a(){this.size=[60,20],this.addInput("value",0,{label:""}),this.addOutput("value",0,{label:""}),this.addProperty("value","")}a.title="Watch",a.desc="Show value of input",a.prototype.onExecute=function(){this.properties.value=this.getInputData(0),this.setOutputData(0,this.properties.value)},a.prototype.onDrawBackground=function(u){if(this.inputs[0]&&this.properties.value!=null)if(this.properties.value.constructor===Number)this.inputs[0].label=this.properties.value.toFixed(3);else{var p=this.properties.value;p&&p.length&&(p=Array.prototype.slice.call(p).join(",")),this.inputs[0].label=p}};function s(){this.mode=g.a.ON_EVENT,this.size=[60,20],this.addProperty("msg",""),this.addInput("log",g.a.EVENT),this.addInput("msg",0)}s.title="Console",s.desc="Show value inside the console",s.prototype.onAction=function(u,p){u=="log"?console.log(p):u=="warn"?console.warn(p):u=="error"&&console.error(p)},s.prototype.onExecute=function(){var u=this.getInputData(1);u!==null&&(this.properties.msg=u),console.log(u)},s.prototype.onGetInputs=function(){return[["log",g.a.ACTION],["warn",g.a.ACTION],["error",g.a.ACTION]]};function l(){this.size=[60,20],this.addProperty("onExecute",""),this.addInput("in",""),this.addInput("in2",""),this.addOutput("out",""),this.addOutput("out2",""),this._func=null}l.title="Script",l.desc="executes a code",l.widgets_info={onExecute:{type:"code"}},l.prototype.onPropertyChanged=function(u,p){if(u=="onExecute"&&d.d){this._func=null;try{this._func=new Function(p)}catch(c){console.error("Error parsing script"),console.error(c)}}},l.prototype.onExecute=function(){if(this._func)try{this._func.call(this)}catch(u){console.error("Error in script"),console.error(u)}}}]);export{L as LITEGRAPH};
