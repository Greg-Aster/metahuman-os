import{d as h,w as d}from"./index.PToQ82vo.js";import{A as m}from"./api-config.B-uR5Kyo.js";const a={excellent:100,good:250,fair:500,poor:1e3},v={checkIntervalMs:3e4,timeoutMs:5e3,maxConsecutiveFailures:3},s=d({connected:!1,latencyMs:0,quality:"offline",lastCheck:new Date,consecutiveFailures:0}),p=d({...v});let c=null;function k(e,n){return e<a.excellent?"excellent":e<a.good?"good":e<a.fair?"fair":e<a.poor?"poor":"offline"}async function l(){let e;const n=Date.now(),i=m()?"http://127.0.0.1:4322/api/status":"/api/boot";try{const t=await fetch(i,{method:"GET",signal:AbortSignal.timeout(5e3)}),r=Date.now()-n;if(t.ok||t.status===401||t.status===403){let o;if(t.ok)try{o=(await t.json()).version}catch{}e={connected:!0,latencyMs:r,quality:k(r,!0),lastCheck:new Date,consecutiveFailures:0,serverVersion:o}}else{let o=0;s.subscribe(u=>{o=u.consecutiveFailures})(),e={connected:!1,latencyMs:r,quality:"offline",lastCheck:new Date,consecutiveFailures:o+1,error:`Server returned ${t.status}`}}}catch(t){let r=0;s.subscribe(o=>{r=o.consecutiveFailures})(),e={connected:!1,latencyMs:Date.now()-n,quality:"offline",lastCheck:new Date,consecutiveFailures:r+1,error:t instanceof Error?t.message:"Health check failed"}}return s.set(e),e}function f(e){w();let n=v;p.subscribe(i=>{n=i})(),l(),c=setInterval(()=>{l()},n.checkIntervalMs),console.log("[server-health] Monitor started with interval:",n.checkIntervalMs,"ms")}function w(){c&&(clearInterval(c),c=null,console.log("[server-health] Monitor stopped"))}async function b(){return l()}const F=h(s,e=>e.connected);h(s,e=>e.quality);typeof window<"u"&&(setTimeout(()=>{f()},1e3),document.addEventListener("visibilitychange",()=>{document.hidden?w():f()}));export{b as f,s as h,F as i};
