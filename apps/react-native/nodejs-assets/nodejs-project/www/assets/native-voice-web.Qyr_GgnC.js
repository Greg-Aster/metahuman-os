class l{recognition=null;synthesis=null;listeners=new Map;currentUtterance=null;constructor(){if(typeof window<"u"){this.synthesis=window.speechSynthesis||null;const t=window.SpeechRecognition||window.webkitSpeechRecognition;t&&(this.recognition=new t)}}async isAvailable(){return{stt:this.recognition!==null,tts:this.synthesis!==null}}async startListening(t){return new Promise((s,n)=>{if(!this.recognition){n(new Error("Speech recognition not available"));return}this.recognition.lang=t?.language||"en-US",this.recognition.interimResults=!0,this.recognition.maxAlternatives=1,this.recognition.onresult=e=>{const o=e.results.length-1,r=e.results[o],i=r[0].transcript,a=r.isFinal,c={transcript:i,confidence:r[0].confidence,isFinal:a};a?(this.notifyListeners("sttResult",c),s(c)):this.notifyListeners("sttPartialResult",c)},this.recognition.onerror=e=>{this.notifyListeners("sttError",{error:e.error,code:-1}),n(new Error(e.error))},this.recognition.onstart=()=>{this.notifyListeners("sttStart",{})},this.recognition.onend=()=>{this.notifyListeners("sttEnd",{})},this.notifyListeners("sttReady",{}),this.recognition.start()})}async stopListening(){this.recognition?.stop()}async cancelListening(){this.recognition?.abort()}async speak(t){return new Promise((s,n)=>{if(!this.synthesis){n(new Error("Speech synthesis not available"));return}this.synthesis.cancel();const e=new SpeechSynthesisUtterance(t.text);e.pitch=t.pitch??1,e.rate=t.rate??1;const o=this.synthesis.getVoices(),r=o.find(i=>i.lang.startsWith("en")&&i.name.includes("Google"))||o.find(i=>i.lang.startsWith("en"))||o[0];r&&(e.voice=r),e.onstart=()=>{this.notifyListeners("ttsStart",{utteranceId:"web"})},e.onend=()=>{this.notifyListeners("ttsEnd",{utteranceId:"web"}),s({success:!0})},e.onerror=i=>{this.notifyListeners("ttsError",{utteranceId:"web"}),n(new Error(i.error))},this.currentUtterance=e,this.synthesis.speak(e)})}async stopSpeaking(){this.synthesis?.cancel(),this.currentUtterance=null}async getVoices(){return this.synthesis?{voices:this.synthesis.getVoices().map(s=>({name:s.name,locale:s.lang,quality:s.localService?300:100,isNetworkConnectionRequired:!s.localService}))}:{voices:[]}}async addListener(t,s){return this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(s),{remove:async()=>{this.listeners.get(t)?.delete(s)}}}async removeAllListeners(){this.listeners.clear()}notifyListeners(t,s){const n=this.listeners.get(t);n&&n.forEach(e=>e(s))}}export{l as NativeVoiceWeb};
